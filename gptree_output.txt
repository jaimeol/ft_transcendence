# Project Directory Structure:
.
‚îú‚îÄ‚îÄ .gptree_config
‚îú‚îÄ‚îÄ Makefile
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ certs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.crt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.key
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ node_modules/
‚îÇ   ‚îú‚îÄ‚îÄ package.json
‚îÇ   ‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ db.js
‚îÇ       ‚îú‚îÄ‚îÄ routes/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ auth.js
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ friends.js
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ users.js
‚îÇ       ‚îú‚îÄ‚îÄ schema.sql
‚îÇ       ‚îî‚îÄ‚îÄ server.js
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ app.db
‚îÇ   ‚îú‚îÄ‚îÄ app.db-shm
‚îÇ   ‚îú‚îÄ‚îÄ app.db-wal
‚îÇ   ‚îî‚îÄ‚îÄ uploads/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ frontend/
    ‚îú‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ node_modules/
    ‚îú‚îÄ‚îÄ package.json
    ‚îú‚îÄ‚îÄ postcss.config.js
    ‚îú‚îÄ‚îÄ public/
    ‚îÇ   ‚îú‚îÄ‚îÄ dist/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.js
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ register.js
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ translate.js
    ‚îÇ   ‚îú‚îÄ‚îÄ friends.html
    ‚îÇ   ‚îú‚îÄ‚îÄ game.html
    ‚îÇ   ‚îú‚îÄ‚îÄ index.html
    ‚îÇ   ‚îú‚îÄ‚îÄ js/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.js
    ‚îÇ   ‚îú‚îÄ‚îÄ locales/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ en.json
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ es.json
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fr.json
    ‚îÇ   ‚îú‚îÄ‚îÄ login.html
    ‚îÇ   ‚îú‚îÄ‚îÄ menu.html
    ‚îÇ   ‚îú‚îÄ‚îÄ profile.html
    ‚îÇ   ‚îú‚îÄ‚îÄ register.html
    ‚îÇ   ‚îî‚îÄ‚îÄ tailwind.css
    ‚îú‚îÄ‚îÄ src/
    ‚îÇ   ‚îú‚îÄ‚îÄ main.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ register.ts
    ‚îÇ   ‚îú‚îÄ‚îÄ styles.css
    ‚îÇ   ‚îî‚îÄ‚îÄ translate.ts
    ‚îú‚îÄ‚îÄ tailwind.config.js
    ‚îî‚îÄ‚îÄ tsconfig.json

# BEGIN FILE CONTENTS

# File: frontend/public/dist/register.js

var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { initializeLanguages } from "./translate.js";
function qs(sel) {
    return document.querySelector(sel);
}
function setError(msg) {
    const err = qs("#err");
    if (err)
        err.textContent = msg;
}
function disableSubmit(disabled) {
    const btn = qs("#submitBtn");
    if (btn)
        btn.disabled = disabled;
}
function onSubmit(e) {
    return __awaiter(this, void 0, void 0, function* () {
        var _a;
        e.preventDefault();
        const form = e.currentTarget;
        const data = Object.fromEntries(new FormData(form).entries());
        try {
            disableSubmit(true);
            setError("");
            yield api("/api/auth/register", {
                method: "POST",
                body: JSON.stringify(data),
                headers: { "Content-Type": "application/json" },
            });
            location.href = "../menu.html";
        }
        catch (err) {
            setError((_a = err === null || err === void 0 ? void 0 : err.message) !== null && _a !== void 0 ? _a : "Error inesperado");
        }
        finally {
            disableSubmit(false);
        }
    });
}
function setupEmailReadOnly() {
    const emailInput = qs('input[name="email"]');
    if (!emailInput)
        return;
    const enable = () => emailInput.removeAttribute("readonly");
    const disable = () => emailInput.setAttribute("readonly", "true");
    disable();
    emailInput.addEventListener('pointerdown', enable);
    emailInput.addEventListener('focus', enable);
    emailInput.addEventListener('keydown', enable);
    emailInput.addEventListener("blur", disable);
    setTimeout(() => {
        if (document.activeElement === emailInput)
            enable();
    }, 0);
}
function setupPasswordToggle() {
    const pwd = qs("#pwd");
    const toggle = qs("#togglePwd");
    if (!pwd || !toggle)
        return;
    toggle.addEventListener("click", () => {
        const isPwd = pwd.type === "password";
        pwd.type = isPwd ? "text" : "password";
        toggle.textContent = isPwd ? "üôà" : "üëÅÔ∏è";
    });
}
window.addEventListener("DOMContentLoaded", () => __awaiter(void 0, void 0, void 0, function* () {
    yield initializeLanguages();
    const form = qs("#f");
    if (form)
        form.addEventListener("submit", onSubmit);
    setupEmailReadOnly();
    setupPasswordToggle();
}));


# END FILE CONTENTS


# File: backend/Dockerfile

FROM node:18

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

RUN mkdir -p /app/data

EXPOSE 1234

CMD ["npm", "start"]

# END FILE CONTENTS


# File: frontend/Dockerfile

FROM node:18

WORKDIR /app

COPY package*.json ./

RUN npm install

COPY . .

CMD ["npm", "run", "build:ts"]

# END FILE CONTENTS


# File: frontend/public/index.html

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ft_Transcendence</title>
  <link rel="stylesheet" href="/tailwind.css" />
</head>
<body class="min-h-screen bg-gradient-to-br from-black via-zinc-900 to-black text-white relative overflow-hidden">

  <!-- Accentos de fondo -->
  <div class="pointer-events-none absolute -top-24 -left-24 w-[36rem] h-[36rem] rounded-full bg-indigo-600/20 blur-3xl"></div>
  <div class="pointer-events-none absolute -bottom-32 -right-24 w-[30rem] h-[30rem] rounded-full bg-emerald-500/20 blur-3xl"></div>

  <!-- Selector de idioma -->
  <div class="absolute top-4 right-4 z-50 text-sm/none">
    <div class="bg-white/5 border border-white/10 backdrop-blur px-3 py-1.5 rounded-full shadow">
      <button class="hover:underline" onclick="changeLanguage?.('en')" aria-label="Change language to English">EN</button>
      <span class="mx-2 text-white/50">|</span>
      <button class="hover:underline" onclick="changeLanguage?.('es')" aria-label="Cambiar idioma a Espa√±ol">ES</button>
      <span class="mx-2 text-white/50">|</span>
      <button class="hover:underline" onclick="changeLanguage?.('fr')" aria-label="Changer la langue en Fran√ßais">FR</button>
    </div>
  </div>

  <!-- Contenido centrado -->
  <main class="w-full min-h-screen flex items-center justify-center px-4">
    <section class="w-full max-w-md">
      <!-- Tarjeta -->
      <div class="bg-white/5 border border-white/10 backdrop-blur-xl rounded-2xl shadow-2xl p-8">
        <!-- Logo / t√≠tulo -->
        <div class="flex items-center gap-3 mb-6">
          <div class="size-10 rounded-xl bg-gradient-to-br from-indigo-400 to-emerald-400 shadow-lg"></div>
          <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">
            <span class="bg-gradient-to-r from-indigo-300 via-sky-300 to-emerald-300 bg-clip-text text-transparent">
              Ft_Transcendence
            </span>
          </h1>
        </div>
        <!-- CTA -->
        <div class="flex flex-col sm:flex-row gap-3">
          <a href="/register.html"
             class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-xl text-base font-medium
                    bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700
                    shadow-lg shadow-indigo-600/25 transition
                    focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-400 focus-visible:ring-offset-black"
             data-translate="register" aria-label="Registrarse">
            ‚ú® <span>Registrarse</span>
          </a>

          <a href="/login.html"
             class="inline-flex items-center justify-center gap-2 px-6 py-3 rounded-xl text-base font-medium
                    bg-white/10 hover:bg-white/15 active:bg-white/20
                    border border-white/10
                    transition
                    focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-white/40 focus-visible:ring-offset-black"
             data-translate="login" aria-label="Iniciar sesi√≥n">
            üîë <span>Iniciar sesi√≥n</span>
          </a>
        </div>
      </div>

      <!-- Pie sutil -->
      <div class="text-center mt-6 text-xs text-white/50">
        <span data-translate="landing.footer">¬© 2025 Ft_Transcendence. All rights reserved.</span>
      </div>
    </section>
  </main>
  <script type="module">
    import { initializeLanguages, changeLanguage } from '/dist/translate.js';

    document.addEventListener('DOMContentLoaded', () => {
      initializeLanguages();
    });

    window.changeLanguage = changeLanguage;
  </script>

</body>
</html>


# END FILE CONTENTS


# File: frontend/package.json

{
  "name": "frontend",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1",
    "dev": "concurrently \"npm:watch:tailwind\" \"npm:watch:ts\"",
    "watch:tailwind": "tailwindcss -i ./src/styles.css -o ./public/tailwind.css --watch",
    "watch:ts": "tsc --watch",
    "build:ts": "tsc",
    "serve": "serve public"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "devDependencies": {
    "autoprefixer": "^10.4.21",
    "concurrently": "^9.2.0",
    "postcss": "^8.5.6",
    "serve": "^14.2.4",
    "tailwindcss": "^3.4.17",
    "typescript": "^5.9.2"
  },
  "dependencies": {
    "browserslist": "^4.25.1",
    "caniuse-lite": "^1.0.30001727",
    "electron-to-chromium": "^1.5.191",
    "escalade": "^3.2.0",
    "fraction.js": "^4.3.7",
    "i18next": "^25.3.4",
    "i18next-browser-languagedetector": "^8.2.0",
    "i18next-http-backend": "^3.0.2",
    "nanoid": "^3.3.11",
    "node-releases": "^2.0.19",
    "normalize-range": "^0.1.2",
    "picocolors": "^1.1.1",
    "postcss-value-parser": "^4.2.0",
    "source-map-js": "^1.2.1",
    "update-browserslist-db": "^1.1.3"
  },
  "description": ""
}


# END FILE CONTENTS


# File: backend/certs/server.key

-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC2o0KbC1LtP6wy
Qb7IatkX1dtGGTFI4Cjkw+45VxmBF84uBb5RF18TuE4y33zuq8gDB/fzItgHqyiu
nx+TjPkJzsyCkjxpPdT8kSGR26VXalEKIwjXnEOtp2o8EgiFPzZTDYT8t0Jdcqkw
/BmLrmvGQWpHAqmOUT73DxU1cEzQaimpJ9yFcpX/fKQBtu+mXdRl4MUjkea5XiXC
+D61EC4DoU2ev8R0+gyupX5QV0VWa+GNoamSwAlnREkkOcY/vGWSKAhX2Mr4qoi6
EAF47l1ZMqzeZxpUAOVenNaqXMkuqdwz3j6UW3vrP6FdeUQ6PonbC0uU0TV3XpN4
kDZ68UaLAgMBAAECggEADQfxBKb2L79PRfay6hHVk4HKt2GsxopX4JqqMKUqSK+u
IlJ+lcKZIgsQaUjQ3SacirrS0iI2T7XCnVL1Kc3xJuX+aYKNlOS4gZzJTGLjlS0c
wyBkzR11Jrq/NbIDsZ4k/iAE0RMyRQCdWcVi/ThgsDCSqKZj+qeJWo9U8A8nK+eI
Xi6OIZvpb/6hoDkni6/yXyV+0pPakXOCh2tMIH1hJjBfdLsKBF+8oHcaUob+HzMI
lrnUqvhs51IKGtMbCHkH//WznKr+Ux1yt35juG+J5MfDTleELiUnHUlqybfZahkO
PXwHTRgf+0yIjeNmWFwXxWUx2Lg6yoQcN2ltnNBNgQKBgQDZWmZsRyXTThaNnwDg
v/TJBZSseIrwnnlK7IkeA9Givh+aMnQbDrm7isByRac5rnxSAD1ksQHz4OtY6JZt
AhWj9O6wtirxmTa6/f3kBHFjuCAPtHmy22yfB3JTrUqFz5xxn3VZWFpwyJb5zsPt
/On8eSqtK7JsrgXLcogpdaESuwKBgQDXHKptYzKIqmMm32IyjKbn8wc5u04SEHzV
3AchzIkhTb61jXINuq+CZuuu4aoY5PiNDA4FHJdUY5X1cQFpsC4RDbEnUus4vME5
3Uv4upsRe1DNcgosQKniyQMW2sOxar4fi76yXfqiRTsq0bjT9A3Pp666/luwxCaz
rwCMkczmcQKBgGIgCMtrV21M/KuVFB1jK8yxI0y14uv8b3/ex4xwZu0U7kl766Tn
gfxkCLvOLE/DMUcH6q+RpfMHINjzsC2oWkK56iSHKV4HMIk876lIRDSjxH2ymZqg
qyokf329Zz5/2v4E4kKiu7ndJSPEL/o6Sxx7S0QAzT15Vw5hN42YGE7PAoGBALG6
AmlcUw0tUbx1RcmkAeaUGb0uLwOn0axUHSRkvEvi0xVnZvtG6elgpYsY8ZOd4mmO
syqwA6v6l5RxKIysvnLikCKAVM3MzgzD9Rfs/V/FNe54MUV8q6AvGjlQx+yW17xy
lj0CfqiBcLAhFIcyFhMiZLAkpZb3iU5d4aNCdztRAoGABfWNLOelw7V5Dese4t5O
hrxVaqxTpwB6w45QJxV5Y5l9ZUSFP36y5yC8cW5XSo55fPV1v7zBOZJ9+FXNkVnU
JvjGLeAo1esJdPvMlpGISpkS8Hj31JSv3PAb2vfITugBtqkAAoHW5F/drxa/4VH8
ppqOBqhU5/9kJUxUzzW9QkQ=
-----END PRIVATE KEY-----


# END FILE CONTENTS


# File: frontend/public/dist/main.js

var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import { currentTranslations, initializeLanguages } from "./translate.js";
window.addEventListener('DOMContentLoaded', () => __awaiter(void 0, void 0, void 0, function* () {
    yield initializeLanguages();
    const canvas = document.getElementById('pong');
    if (!canvas) {
        console.error('Canvas element not found!');
        return;
    }
    const ctx = canvas.getContext('2d');
    if (!ctx) {
        throw new Error('No se pudo obtener el contexto 2D');
    }
    const paddleWidth = 10;
    const paddleHeight = 120;
    const ballRadius = 10;
    const INITIAL_BALL_SPEED = 5;
    const MAX_BALL_SPEED = 10;
    const paddleSpeed = 5;
    const keys = {};
    let leftPaddleY = (canvas.height - paddleHeight) / 2;
    let rightPaddleY = (canvas.height - paddleHeight) / 2;
    let ballX = canvas.width / 2;
    let ballY = canvas.height / 2;
    let ballSpeedX = 12;
    let ballSpeedY = 12;
    let leftScore = 0;
    let rightScore = 0;
    let gameRunning = false;
    let gameOver = false;
    window.addEventListener('keydown', (e) => {
        if (isAI && (e.key === 'ArrowUp' || e.key === 'ArrowDown') && e.isTrusted)
            return;
        keys[e.key] = true;
        if (e.key === ' ') {
            if (!gameRunning && !gameOver) {
                gameRunning = true;
                resetBall();
            }
            else if (gameOver) {
                leftScore = 0;
                rightScore = 0;
                gameOver = false;
                gameRunning = false;
                resetBall();
                updateScore();
            }
        }
    });
    window.addEventListener('keyup', (e) => {
        if (isAI && (e.key === 'ArrowUp' || e.key === 'ArrowDown') && e.isTrusted)
            return;
        keys[e.key] = false;
    });
    function drawRect(x, y, w, h, color, ctx) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, w, h);
    }
    function drawCircle(x, y, r, color, ctx) {
        ctx.fillStyle = color;
        ctx.beginPath();
        ctx.arc(x, y, r, 0, Math.PI * 2, false);
        ctx.closePath();
        ctx.fill();
    }
    function draw(ctx) {
        console.log("Drawing");
        drawRect(0, 0, canvas.width, canvas.height, 'black', ctx);
        drawRect(10, leftPaddleY, paddleWidth, paddleHeight, 'white', ctx);
        drawRect(canvas.width - 20, rightPaddleY, paddleWidth, paddleHeight, 'white', ctx);
        drawCircle(ballX, ballY, ballRadius, 'white', ctx);
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        if (gameOver) {
            ctx.font = '40px Arial';
            ctx.fillText(currentTranslations['game_over'], canvas.width / 2, canvas.height / 2 - 100);
            ctx.font = '20px Arial';
            ctx.fillText(currentTranslations['press_space_restart'], canvas.width / 2, canvas.height / 2 - 40);
        }
        else if (!gameRunning) {
            ctx.font = '40px Arial';
            ctx.fillText(currentTranslations['press_space_start'], canvas.width / 2, canvas.height / 2 - 40);
        }
    }
    const urlParams = new URLSearchParams(window.location.search);
    const isAI = urlParams.get('mode') === 'ai';
    let difficulty = urlParams.get('level');
    const overlay = document.getElementById('difficulty-overlay');
    if (!isAI || difficulty) {
        if (overlay)
            overlay.style.display = 'none';
    }
    else {
        if (overlay)
            overlay.style.display = 'flex';
        const buttons = document.querySelectorAll('.difficulty-btn');
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                const level = btn.getAttribute('data-level');
                if (!level)
                    return;
                urlParams.set('level', level);
                overlay === null || overlay === void 0 ? void 0 : overlay.classList.remove('animate-fade-in');
                overlay === null || overlay === void 0 ? void 0 : overlay.classList.add('animate-fade-out');
                setTimeout(() => {
                    const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
                    window.location.replace(newUrl);
                }, 400);
            });
        });
        return;
    }
    if (isAI) {
        keys['ArrowUp'] = false;
        keys['ArrowDown'] = false;
        let aiPressedKey = null;
        function simulateKeyPress(key) {
            if (!keys[key]) {
                const event = new KeyboardEvent('keydown', {
                    key,
                    bubbles: true,
                    cancelable: true,
                });
                window.dispatchEvent(event);
            }
        }
        function simulateKeyRelease(key) {
            if (keys[key]) {
                const event = new KeyboardEvent('keyup', {
                    key,
                    bubbles: true,
                    cancelable: true,
                });
                window.dispatchEvent(event);
            }
        }
        function predictballY() {
            let x = ballX;
            let y = ballY;
            let dx = ballSpeedX;
            let dy = ballSpeedY;
            if (dx <= 0)
                return rightPaddleY + paddleHeight / 2;
            while (x < canvas.width - 20) {
                x += dx;
                y += dy;
                if (y - ballRadius < 0 || y + ballRadius > canvas.height) {
                    dy *= -1;
                    y = Math.max(ballRadius, Math.min(canvas.height - ballRadius, y));
                }
            }
            return y;
        }
        function updateAI() {
            if (!gameRunning)
                return;
            if (ballSpeedX <= 0) {
                if (aiPressedKey) {
                    simulateKeyRelease(aiPressedKey);
                    aiPressedKey = null;
                }
                return;
            }
            const predictedY = predictballY();
            const paddleCenter = rightPaddleY + paddleHeight / 2;
            const diff = predictedY - paddleCenter;
            let DEAD_ZONE = 60;
            if (difficulty === 'easy')
                DEAD_ZONE = 110;
            else if (difficulty === 'medium')
                DEAD_ZONE = 75;
            else if (difficulty === 'hard')
                DEAD_ZONE = 60;
            let keyToPress = null;
            if (diff < -DEAD_ZONE && rightPaddleY > 0) {
                keyToPress = 'ArrowUp';
            }
            else if (diff > DEAD_ZONE && rightPaddleY + paddleHeight < canvas.height) {
                keyToPress = 'ArrowDown';
            }
            if (keyToPress !== aiPressedKey) {
                if (aiPressedKey)
                    simulateKeyRelease(aiPressedKey);
                if (keyToPress)
                    simulateKeyPress(keyToPress);
                aiPressedKey = keyToPress;
            }
        }
        setInterval(updateAI, 100); // M√°s reactivo: cada 100ms
    }
    function update() {
        if (!gameRunning)
            return;
        if (keys['w'] && leftPaddleY > 0) {
            leftPaddleY -= paddleSpeed;
        }
        if (keys['s'] && leftPaddleY + paddleHeight < canvas.height) {
            leftPaddleY += paddleSpeed;
        }
        if (keys['ArrowUp'] && rightPaddleY > 0) {
            rightPaddleY -= paddleSpeed;
        }
        if (keys['ArrowDown'] && rightPaddleY + paddleHeight < canvas.height) {
            rightPaddleY += paddleSpeed;
        }
        ballX += ballSpeedX;
        ballY += ballSpeedY;
        // Ball bounce on top and bottom walls
        if (ballY + ballRadius > canvas.height || ballY - ballRadius < 0) {
            ballSpeedY = -ballSpeedY;
        }
        // Ball bounce on left paddle
        if (ballX - ballRadius < 20 && ballY > leftPaddleY && ballY < leftPaddleY + paddleHeight) {
            const relativeIntersectY = (leftPaddleY + paddleHeight / 2) - ballY;
            const normalized = relativeIntersectY / (paddleHeight / 2);
            const bounceAngle = normalized * (Math.PI / 4);
            const currentSpeed = Math.sqrt(Math.pow(ballSpeedX, 2) + Math.pow(ballSpeedY, 2));
            const speed = Math.min(currentSpeed * 1.05, MAX_BALL_SPEED);
            ballSpeedX = speed * Math.cos(bounceAngle);
            ballSpeedY = -speed * Math.sin(bounceAngle);
        }
        // Ball bounce on right paddle
        if (ballX + ballRadius > canvas.width - 20 && ballY > rightPaddleY && ballY < rightPaddleY + paddleHeight) {
            const relativeIntersectY = (rightPaddleY + paddleHeight / 2) - ballY;
            const normalized = relativeIntersectY / (paddleHeight / 2);
            const bounceAngle = normalized * (Math.PI / 4);
            const currentSpeed = Math.sqrt(Math.pow(ballSpeedX, 2) + Math.pow(ballSpeedY, 2));
            const speed = Math.min(currentSpeed * 1.05, MAX_BALL_SPEED);
            ballSpeedX = -speed * Math.cos(bounceAngle);
            ballSpeedY = -speed * Math.sin(bounceAngle);
        }
        // Score and reset if ball goes out on left side
        if (ballX + ballRadius < 0) {
            rightScore++;
            checkGameOver();
            updateScore();
            resetBall(0);
            resetPaddles();
        }
        // Score and reset if ball goes out on right side
        if (ballX - ballRadius > canvas.width) {
            leftScore++;
            checkGameOver();
            updateScore();
            resetBall(1);
            resetPaddles();
        }
    }
    function resetBall(flag) {
        ballX = canvas.width / 2;
        ballY = canvas.height / 2;
        ballSpeedX = flag ? INITIAL_BALL_SPEED : -INITIAL_BALL_SPEED;
        ballSpeedY = 0;
    }
    function resetPaddles() {
        leftPaddleY = (canvas.height - paddleHeight) / 2;
        rightPaddleY = (canvas.height - paddleHeight) / 2;
    }
    function checkGameOver() {
        if (leftScore >= 5 || rightScore >= 5) {
            gameOver = true;
            gameRunning = false;
        }
    }
    function updateScore() {
        const scoreEl = document.getElementById('score');
        if (scoreEl) {
            scoreEl.textContent = `${leftScore} : ${rightScore}`;
        }
    }
    function gameLoop(ctx) {
        update();
        draw(ctx);
        requestAnimationFrame(() => gameLoop(ctx));
    }
    gameLoop(ctx);
}));


# END FILE CONTENTS


# File: frontend/public/friends.html

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Amigos ‚Äî ft_transcendence</title>
  <link rel="stylesheet" href="/tailwind.css"/>
  <style>
    .avatar { border-radius: 50%; }
  </style>
</head>
<body class="bg-black text-white flex items-center justify-center min-h-screen">
  <div class="bg-zinc-900 p-6 rounded-2xl shadow w-[520px]">
    <h1 class="text-2xl font-bold mb-4">Amigos</h1>

    <!-- Lista de amigos -->
    <div id="list" class="space-y-2 text-sm">Cargando...</div>
    <div id="err" class="text-red-400 text-sm min-h-[1.25rem] mt-2"></div>

    <!-- Navegaci√≥n -->
    <div class="flex justify-between mt-4">
      <a class="underline opacity-80 hover:opacity-100" href="/profile.html">Perfil</a>
      <a class="underline opacity-80 hover:opacity-100" href="/">Inicio</a>
    </div>
  </div>

  <script src="/js/api.js"></script>
  <script>
    function escape(s){
      return (s||'').replace(/[&<>"']/g, c => (
        {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]
      ));
    }

    async function loadFriends(){
      const listEl = document.getElementById('list');
      const errBox = document.getElementById('err');
      listEl.textContent = "Cargando...";
      errBox.textContent = "";

      try {
        const { friends } = await api('/api/friends');
        if (!friends || friends.length === 0) {
          listEl.textContent = "Todav√≠a no tienes amigos üò¢";
          return;
        }

        listEl.innerHTML = friends.map(f => `
          <div class="flex items-center gap-3 p-2 rounded bg-zinc-800/60 hover:bg-zinc-800 transition">
            <img src="${f.avatar_path || '/default-avatar.png'}" width="36" height="36" class="avatar" alt="Avatar">
            <div>
              <div class="font-semibold">${escape(f.display_name)}</div>
              <div class="opacity-70 text-xs">${f.online ? 'üü¢ Online' : '‚ö™ Offline'}</div>
            </div>
          </div>`).join('');
      } catch (err) {
        if (err?.status === 401) {
          location.href = '/login.html';
        } else {
          listEl.textContent = "";
          errBox.textContent = "‚ùå Error cargando amigos";
        }
      }
    }

    loadFriends();
  </script>
</body>
</html>


# END FILE CONTENTS


# File: frontend/public/game.html

<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Pong - Ft_Transcendence</title>
	<link rel="stylesheet" href="./tailwind.css" />
</head>

<body class="bg-black flex flex-col items-center justify-center min-h-screen">

	<div class="language-selector absolute top-4 right-4 text-sm text-white z-[60]">
        <button class="hover:underline" onclick="changeLanguage('en')">EN</button>
        <span class="mx-1">|</span>
        <button class="hover:underline" onclick="changeLanguage('es')">ES</button>
        <span class="mx-1">|</span>
        <button class="hover:underline" onclick="changeLanguage('fr')">FR</button>
    </div>

	<h1 class="text-white text-4xl font-bold mb-8">Ft_Transcendence</h1>
	<div id="score" class="text-white text-2xl font-mono mb-4">0 : 0</div>
	
	<div id="difficulty-overlay" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 animate-fade-in">
		<div class="bg-gray-800 rounded-2xl p-8 shadow-lg flex flex-col items-center gap-6">
			<h2 class="text-white text-2xl font-bold mb-4" data-translate="select_difficulty">Selecciona dificultad</h2>
				<div class="flex gap-4">
					<button type="button" class="difficulty-btn bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded" data-translate="easy" data-level="easy">F√°cil</button>
					<button type="button" class="difficulty-btn bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded" data-translate="medium" data-level="medium">Media</button>
					<button type="button" class="difficulty-btn bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded" data-translate="hard" data-level="hard">Dif√≠cil</button>
				</div>
		</div>
	</div>


	<canvas
		id="pong"
		width="1200"
		height="800"
		class="bg-gray-900 border-4 border-white"
	></canvas>

	<script type="module" src="./dist/main.js"></script>

	<script type="module">
		import { initializeLanguages, changeLanguage } from './dist/translate.js';

		document.addEventListener('DOMContentLoaded', () => {
			initializeLanguages();
		});

		window.changeLanguage = changeLanguage;
	</script>
</body>
</html>


# END FILE CONTENTS


# File: frontend/public/login.html

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Iniciar sesi√≥n</title>
  <link rel="stylesheet" href="/tailwind.css" />
  <style>
    input {
      color: #000000 !important;
    }
    input:not(:placeholder-shown) {
      color: #000000 !important;
    }
    input::placeholder {
      color: #6b7280 !important;
    }
  </style>
</head>
<body class="bg-black text-white flex items-center justify-center min-h-screen">
  <main class="w-full max-w-md p-8 rounded-2xl bg-zinc-900/60 backdrop-blur">
    <h1 class="text-3xl font-bold mb-8 text-center">Iniciar sesi√≥n</h1>

    <form id="login-form" class="space-y-6" autocomplete="on">
      <div class="space-y-2">
        <label for="email" class="block text-sm text-zinc-300">Email</label>
        <input
          id="email"
          name="email"
          type="email"
          inputmode="email"
          autocomplete="username"
          autocapitalize="none"
          spellcheck="false"
          class="w-full px-4 py-3 rounded-lg bg-zinc-800 text-white placeholder-zinc-400 outline-none ring-1 ring-zinc-700 focus:ring-2 focus:ring-indigo-500 transition"
          placeholder="tu@email.com"
          required
        />
      </div>

      <div class="space-y-2">
        <label for="password" class="block text-sm text-zinc-300">Contrase√±a</label>
        <input
          id="password"
          name="password"
          type="password"
          autocomplete="current-password"
          class="w-full px-4 py-3 rounded-lg bg-zinc-800 text-white placeholder-zinc-400 outline-none ring-1 ring-zinc-700 focus:ring-2 focus:ring-indigo-500 transition"
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
          required
        />
      </div>

      <button
        type="submit"
        class="w-full bg-indigo-600 hover:bg-indigo-700 px-4 py-3 rounded-lg text-lg font-semibold transition"
      >
        Entrar
      </button>

      <p class="text-sm text-center text-zinc-400">
        ¬øNo tienes cuenta?
        <a class="text-indigo-400 hover:text-indigo-300 underline" href="/register.html">Reg√≠strate</a>
      </p>
    </form>
  </main>

  <script src="/js/api.js"></script>
  <script>
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.currentTarget;
      const body = {
        email: form.email.value.trim(),
        password: form.password.value
      };

      try {
        const res = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify(body)
        });
        if (!res.ok) throw new Error('Credenciales incorrectas');
        window.location.href = '/menu.html';
      } catch (err) {
        alert(err.message || 'Error al iniciar sesi√≥n');
      }
    });
  </script>
</body>
</html>


# END FILE CONTENTS


# File: frontend/src/register.ts

import { initializeLanguages } from "./translate.js";

declare global {
	interface Window {
		api: (url: string, init?: RequestInit) => Promise<any>;
	}
}

declare const api: (url: string, init?: RequestInit) => Promise<any>;

function qs<T extends HTMLElement = HTMLElement> (sel: string) {
	return document.querySelector(sel) as T | null;
}

function setError(msg: string) {
	const err = qs<HTMLDivElement>("#err");
	if (err) err.textContent = msg;
}

function disableSubmit(disabled: boolean) {
	const btn = qs<HTMLButtonElement>("#submitBtn");
	if (btn) btn.disabled = disabled;
}

async function onSubmit(e: Event) {
	e.preventDefault();
	const form = e.currentTarget as HTMLFormElement;
	const data = Object.fromEntries(new FormData(form).entries());

	try {
		disableSubmit(true);
		setError("");
		await api("/api/auth/register", {
			method: "POST",
			body: JSON.stringify(data),
			headers: { "Content-Type": "application/json" },
		});
		location.href = "../menu.html";
	} catch (err: any) {
		setError(err?.message ?? "Error inesperado");
	} finally {
		disableSubmit (false);
	}
}

function setupEmailReadOnly() {
	const emailInput = qs<HTMLInputElement>('input[name="email"]');
	if (!emailInput) return;

	const enable = () => emailInput.removeAttribute("readonly");
	const disable = () => emailInput.setAttribute("readonly", "true");

	disable();

	emailInput.addEventListener('pointerdown', enable);
	emailInput.addEventListener('focus', enable);
	emailInput.addEventListener('keydown', enable);

	emailInput.addEventListener("blur", disable);

	setTimeout(() => {
		if (document.activeElement === emailInput) enable();
	}, 0);
}

function setupPasswordToggle() {
	const pwd = qs<HTMLInputElement>("#pwd");
	const toggle = qs<HTMLButtonElement>("#togglePwd");
	if (!pwd || !toggle) return;

	toggle.addEventListener("click", () => {
		const isPwd = pwd.type === "password";
		pwd.type = isPwd ? "text" : "password";
		toggle.textContent = isPwd ? "üôà" : "üëÅÔ∏è";
	});
}

window.addEventListener("DOMContentLoaded", async () => { 
	await initializeLanguages();
	const form = qs<HTMLFormElement>("#f");
	if (form) form.addEventListener("submit", onSubmit);

	setupEmailReadOnly();
	setupPasswordToggle();
})

# END FILE CONTENTS


# File: backend/src/server.js

const path = require('path');
const fs = require('fs');
const Fastify = require('fastify');
const fastifyStatic = require('@fastify/static');
const cors = require('@fastify/cors');
const multipart = require('@fastify/multipart');
const cookie = require('@fastify/cookie');
const session = require('@fastify/session');
const formbody = require('@fastify/formbody');

const authRoutes = require('./routes/auth');
const usersRoutes = require('./routes/users');
const friendsRoutes = require('./routes/friends');
require('./db');

const certsDir = path.join(__dirname, '..', 'certs');
const httpsOptions = {
  key: fs.readFileSync(path.join(certsDir, 'server.key')),
  cert: fs.readFileSync(path.join(certsDir, 'server.crt'))
};

const app = Fastify({ https: httpsOptions, logger: true });

app.register(cors, { origin: true, credentials: true });
app.register(formbody);
app.register(multipart);
app.register(cookie);
app.register(session, {
  cookieName: 'sessionId',
  secret: '12345678901234567890123456789012', //esto quiza lo meta en un .env
  cookie: { httpOnly: true, sameSite: 'lax', secure: false }
});

app.register(fastifyStatic, {
  root: path.join(__dirname, '..', 'public'),
  prefix: '/',
});

const uploadsDir = path.join('/app', 'data', 'uploads');
fs.mkdirSync(uploadsDir, { recursive: true });
app.get('/uploads/*', async (req, reply)=>{
  const p = req.params['*'];
  const file = path.join(uploadsDir, p);
  if(!fs.existsSync(file)) return reply.code(404).send();
  return reply.send(fs.createReadStream(file));
});

app.register(authRoutes);
app.register(usersRoutes);
app.register(friendsRoutes);

const PORT = 1234;
app.listen({ port: PORT, host: '0.0.0.0' }, (err, address)=>{
  if(err){ app.log.error(err); process.exit(1); }
  console.log('Servidor en', address);
});


# END FILE CONTENTS


# File: frontend/public/locales/fr.json

{
  "play_1v1": "Jouer 1v1",
  "play_ai": "Jouer contre l'IA",
  "select_difficulty": "Choisissez la difficult√©",
  "easy": "Facile",
  "medium": "Moyenne",
  "hard": "Difficile",
  "game_over": "Fin de partie",
  "press_space_start": "Appuyez sur la barre d'espace pour d√©marrer.",
  "press_space_restart": "Appuyez sur la barre d'espace pour red√©marrer."
}

# END FILE CONTENTS


# File: frontend/src/styles.css

@tailwind base;
@tailwind components;
@tailwind utilities;

@keyframes fade-in {
  from { opacity: 0; }
  to { opacity: 1; }
}

.animate-fade-in {
  animation: fade-in 0.4s ease-out forwards;
}


@keyframes fade-out {
  from { opacity: 1; }
  to { opacity: 0; }
}

.animate-fade-out {
  animation: fade-out 0.4s ease-out forwards;
  pointer-events: none;
}

@keyframes zoom-into-game {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(20);
    opacity: 0;
  }
}

.zoom-into-game {
  animation: zoom-into-game 0.5s ease-out forwards;
  z-index: 50;
}



# END FILE CONTENTS


# File: frontend/public/locales/es.json

{
  "main_title": "Ft_Transcendence",
  "play_1v1": "Jugar 1v1",
  "play_ai": "Jugar contra IA",
  "select_difficulty": "Selecciona Dificultad",
  "easy": "F√°cil",
  "medium": "Media",
  "hard": "Dif√≠cil",
  "game_over": "Fin del Juego",
  "press_space_start": "Pulsa Espacio para Empezar",
  "press_space_restart": "Pulsa Espacio para Reiniciar"
}

# END FILE CONTENTS


# File: .gptree_config

# GPTree Local Config
version: 3

# Whether to use .gitignore
useGitIgnore: true
# File types to include (e.g., .py,.js) - use * for all types
includeFileTypes: *
# File types to exclude (e.g., .log,.tmp)
excludeFileTypes: 
# Advanced: Glob patterns to include (e.g., src/**/*.py,**/*.js) - overrides includeFileTypes if specified
includePatterns: 
# Advanced: Glob patterns to exclude (e.g., **/tests/**,**/*.log) - combined with excludeFileTypes
excludePatterns: 
# Output file name
outputFile: gptree_output.txt
# Whether to output the file locally or relative to the project directory
outputFileLocally: true
# Whether to copy the output to the clipboard
copyToClipboard: false
# Whether to use safe mode (prevent overly large files from being combined)
safeMode: true
# Whether to store the files chosen in the config file (--save, -s)
storeFilesChosen: true
# Whether to include line numbers in the output (--line-numbers, -n)
lineNumbers: false
# Whether to show ignored files in the directory tree
showIgnoredInTree: false
# Whether to show only default ignored files in the directory tree while still respecting gitignore
showDefaultIgnoredInTree: false
# Previously selected files (when using the -s or --save flag previously)
previousFiles: 


# END FILE CONTENTS


# File: frontend/src/translate.ts



export let currentTranslations: Record<string, string> = {};

export type language = "es" | "fr" | "en";

export function getCurrentLanguage(): language {
	const savedLang = localStorage.getItem('language') as language;
	if (savedLang && ['es', 'en', 'fr'].includes(savedLang))
		return savedLang;
	const browserLang = navigator.language.split('-')[0] as language;
	if (['es', 'en', 'fr'].includes(browserLang))
		return browserLang;
	return 'en';
}

export async function loadTranslations(lang: language): Promise<void> {
	try {
		const response = await fetch(`/locales/${lang}.json`);
		if (!response.ok)
			throw new Error(`Language ${lang} not found.`);
		currentTranslations = await response.json();
		console.log(`Translations for ${lang} loaded`);
	} catch(error) {
		console.error(error);
		const response = await fetch(`/locales/en.json`);
		currentTranslations = await response.json();
	}
}

export function updateContent(): void {
	const lang = getCurrentLanguage();
	document.documentElement.lang = lang;
	const elements = document.querySelectorAll<HTMLElement>('[data-translate]');

	elements.forEach(el => {
		const key = el.getAttribute('data-translate');
		if (key && currentTranslations[key]) {
			el.innerHTML = currentTranslations[key];
		}
	});
}

export async function changeLanguage(lang: language): Promise<void> {
	localStorage.setItem('language', lang);
	await loadTranslations(lang);
	updateContent();
}

(window as any).changeLanguage = changeLanguage;

export function initializeAnimations() {
	const gameLinks = document.querySelectorAll<HTMLAnchorElement>('.game-link');

	gameLinks.forEach(link => {
		link.addEventListener('click', (e) => {
			e.preventDefault();
			link.classList.add('zoom-into-game');
			link.style.pointerEvents = 'none';
			setTimeout(() => {
				window.location.href = link.href;
			}, 500);
		});
	});
}

export async function initializeLanguages() {
	const initialLang = getCurrentLanguage();
	await loadTranslations(initialLang);
	updateContent();
	(window as any).changeLanguage = changeLanguage;
}

# END FILE CONTENTS


# File: frontend/src/main.ts

import { currentTranslations, initializeLanguages } from "./translate.js";

window.addEventListener('DOMContentLoaded', async () => {

	await initializeLanguages();
	const canvas = document.getElementById('pong') as HTMLCanvasElement;
	
	if (!canvas) {
		console.error('Canvas element not found!');
		return;
		}
	const ctx = canvas.getContext('2d');
	if (!ctx) {
		throw new Error('No se pudo obtener el contexto 2D');
	}
  
	const paddleWidth = 10;
	const paddleHeight = 120;
	const ballRadius = 10;
	const INITIAL_BALL_SPEED = 5;
	const MAX_BALL_SPEED = 10;
	const paddleSpeed = 5;
  
	const keys: Record<string, boolean> = {};
  
	let leftPaddleY = (canvas.height - paddleHeight) / 2;
	let rightPaddleY = (canvas.height - paddleHeight) / 2;
  
	let ballX = canvas.width / 2;
	let ballY = canvas.height / 2;
	let ballSpeedX = 12;
	let ballSpeedY = 12;
  
	let leftScore = 0;
	let rightScore = 0;
  
	let gameRunning = false;
	let gameOver = false;

	window.addEventListener('keydown', (e: KeyboardEvent) => {
		if (isAI && (e.key === 'ArrowUp' || e.key === 'ArrowDown') && e.isTrusted) return;
		keys[e.key] = true;

		if (e.key === ' ') {
			if (!gameRunning && !gameOver) {
				gameRunning = true;
				resetBall();
			} else if (gameOver) {
				leftScore = 0;
				rightScore = 0;
				gameOver = false;
				gameRunning = false;
				resetBall();
				updateScore();
			}
		}
	});

	window.addEventListener('keyup', (e: KeyboardEvent) => {
		if (isAI && (e.key === 'ArrowUp' || e.key === 'ArrowDown') && e.isTrusted) return;
		keys[e.key] = false;
	});

  
	function drawRect(x: number, y: number, w: number, h: number, color: string, ctx: CanvasRenderingContext2D) {
		ctx.fillStyle = color;
		ctx.fillRect(x, y, w, h);
	}
  
	function drawCircle(x: number, y: number, r: number, color: string, ctx: CanvasRenderingContext2D) {
		ctx.fillStyle = color;
		ctx.beginPath();
		ctx.arc(x, y, r, 0, Math.PI * 2, false);
		ctx.closePath();
		ctx.fill();
	}
  
	function draw(ctx: CanvasRenderingContext2D) {
		console.log("Drawing");
		drawRect(0, 0, canvas.width, canvas.height, 'black', ctx);
		drawRect(10, leftPaddleY, paddleWidth, paddleHeight, 'white', ctx);
		drawRect(canvas.width - 20, rightPaddleY, paddleWidth, paddleHeight, 'white', ctx);
		drawCircle(ballX, ballY, ballRadius, 'white', ctx);
		ctx.fillStyle = 'white';
		ctx.textAlign = 'center';
		if (gameOver) {
			ctx.font = '40px Arial';
			ctx.fillText(currentTranslations['game_over'], canvas.width / 2, canvas.height / 2 - 100);
			ctx.font = '20px Arial';
			ctx.fillText(currentTranslations['press_space_restart'], canvas.width / 2, canvas.height / 2 - 40);
		} else if (!gameRunning) {
			ctx.font = '40px Arial';
			ctx.fillText(currentTranslations['press_space_start'], canvas.width / 2, canvas.height / 2 - 40);
		}
	}
	const urlParams = new URLSearchParams(window.location.search);
	const isAI = urlParams.get('mode') === 'ai';
	let difficulty = urlParams.get('level');


	const overlay = document.getElementById('difficulty-overlay') as HTMLElement;
	if (!isAI || difficulty) {
		if (overlay) overlay.style.display = 'none';
	} else {
		if (overlay) overlay.style.display = 'flex';

		const buttons = document.querySelectorAll<HTMLButtonElement>('.difficulty-btn');
		buttons.forEach(btn => {
			btn.addEventListener('click', () => {
				const level = btn.getAttribute('data-level');
				if (!level) return;

				urlParams.set('level', level);

				overlay?.classList.remove('animate-fade-in');
				overlay?.classList.add('animate-fade-out');

				setTimeout(() => {
					const newUrl = `${window.location.pathname}?${urlParams.toString()}`;
					window.location.replace(newUrl);
				}, 400);
			});
		});
		return;
	}


	if (isAI) {
		keys['ArrowUp'] = false;
		keys['ArrowDown'] = false;

		let aiPressedKey: string | null = null;
	
		function simulateKeyPress(key: string) {
			if (!keys[key]) {
				const event = new KeyboardEvent('keydown', {
					key,
					bubbles: true,
					cancelable: true,
				});
				window.dispatchEvent(event);
			}
		}

		function simulateKeyRelease(key: string) {
			if (keys[key]) {
				const event = new KeyboardEvent('keyup', {
					key,
					bubbles: true,
					cancelable: true,
				});
				window.dispatchEvent(event);
			}
		}

		function predictballY(): number {
			let x = ballX;
			let y = ballY;
			let dx = ballSpeedX;
			let dy = ballSpeedY;
	
			if (dx <= 0) return rightPaddleY + paddleHeight / 2;
	
			while (x < canvas.width - 20) {
				x += dx;
				y += dy;
		
				if (y - ballRadius < 0 || y + ballRadius > canvas.height) {
					dy *= -1;
					y = Math.max(ballRadius, Math.min(canvas.height - ballRadius, y));
				}
			}
			return y;
		}

		function updateAI() {
			if (!gameRunning) return;
	
			if (ballSpeedX <= 0) {
				if (aiPressedKey) {
					simulateKeyRelease(aiPressedKey);
					aiPressedKey = null;
				}
				return;
			}
	
			const predictedY = predictballY();
			const paddleCenter = rightPaddleY + paddleHeight / 2;
			const diff = predictedY - paddleCenter;
			let DEAD_ZONE = 60;

			if (difficulty === 'easy') DEAD_ZONE = 110;
			else if (difficulty === 'medium') DEAD_ZONE = 75;
			else if(difficulty === 'hard') DEAD_ZONE = 60;
	
			let keyToPress: string | null = null;
			
			if (diff < -DEAD_ZONE && rightPaddleY > 0) {
				keyToPress = 'ArrowUp';
			} else if (diff > DEAD_ZONE && rightPaddleY + paddleHeight < canvas.height) {
				keyToPress = 'ArrowDown';
			}
	
			if (keyToPress !== aiPressedKey) {
				if (aiPressedKey) simulateKeyRelease(aiPressedKey);
				if (keyToPress) simulateKeyPress(keyToPress);
					aiPressedKey = keyToPress;
			}
		}
		setInterval(updateAI, 100); // M√°s reactivo: cada 100ms
	}


	function update() {
		if (!gameRunning) return;
		
		if (keys['w'] && leftPaddleY > 0) {
			leftPaddleY -= paddleSpeed;
		}
		
		if (keys['s'] && leftPaddleY + paddleHeight < canvas.height) {
			leftPaddleY += paddleSpeed;
		}
		
		if (keys['ArrowUp'] && rightPaddleY > 0) {
			rightPaddleY -= paddleSpeed;
		}
		if (keys['ArrowDown'] && rightPaddleY + paddleHeight < canvas.height) {
			rightPaddleY += paddleSpeed;
		}

  
	  	ballX += ballSpeedX;
	  	ballY += ballSpeedY;
  
	  // Ball bounce on top and bottom walls
	  	if (ballY + ballRadius > canvas.height || ballY - ballRadius < 0) {
			ballSpeedY = -ballSpeedY;
	  	}
  
	  // Ball bounce on left paddle
	  	if (ballX - ballRadius < 20 && ballY > leftPaddleY && ballY < leftPaddleY + paddleHeight) {
			const relativeIntersectY = (leftPaddleY + paddleHeight / 2) - ballY;
			const normalized = relativeIntersectY / (paddleHeight / 2);
			const bounceAngle = normalized * (Math.PI / 4);
  
			const currentSpeed = Math.sqrt(ballSpeedX ** 2 + ballSpeedY ** 2);
			const speed = Math.min(currentSpeed * 1.05, MAX_BALL_SPEED);
  
			ballSpeedX = speed * Math.cos(bounceAngle);
			ballSpeedY = -speed * Math.sin(bounceAngle);
	  	}
  
	  // Ball bounce on right paddle
	  	if (ballX + ballRadius > canvas.width - 20 && ballY > rightPaddleY && ballY < rightPaddleY + paddleHeight) {
			const relativeIntersectY = (rightPaddleY + paddleHeight / 2) - ballY;
			const normalized = relativeIntersectY / (paddleHeight / 2);
			const bounceAngle = normalized * (Math.PI / 4);
  
			const currentSpeed = Math.sqrt(ballSpeedX ** 2 + ballSpeedY ** 2);
			const speed = Math.min(currentSpeed * 1.05, MAX_BALL_SPEED);
  
			ballSpeedX = -speed * Math.cos(bounceAngle);
			ballSpeedY = -speed * Math.sin(bounceAngle);
	 	}
  
	  // Score and reset if ball goes out on left side
	  	if (ballX + ballRadius < 0) {
			rightScore++;
			checkGameOver();
			updateScore();
			resetBall(0);
			resetPaddles();
	  	}
  
	  // Score and reset if ball goes out on right side
	  	if (ballX - ballRadius > canvas.width) {
			leftScore++;
			checkGameOver();
			updateScore();
			resetBall(1);
			resetPaddles();
		}
	}
  
	function resetBall(flag?: number) {
	  	ballX = canvas.width / 2;
	  	ballY = canvas.height / 2;
	  	ballSpeedX = flag ? INITIAL_BALL_SPEED : -INITIAL_BALL_SPEED;
	  	ballSpeedY = 0;
	}
  
	function resetPaddles() {
	  	leftPaddleY = (canvas.height - paddleHeight) / 2;
	  	rightPaddleY = (canvas.height - paddleHeight) / 2;
	}
  
	function checkGameOver() {
	  	if (leftScore >= 5 || rightScore >= 5) {
			gameOver = true;
			gameRunning = false;
	  	}
	}
  
	function updateScore() {
	  	const scoreEl = document.getElementById('score');
	  	if (scoreEl) {
			scoreEl.textContent = `${leftScore} : ${rightScore}`;
	  	}
	}
  
	function gameLoop(ctx: CanvasRenderingContext2D) {
	  	update();
	  	draw(ctx);
	  	requestAnimationFrame(() => gameLoop(ctx));
	}
	gameLoop(ctx);
});
  

# END FILE CONTENTS


# File: backend/certs/server.crt

-----BEGIN CERTIFICATE-----
MIID7TCCAtWgAwIBAgIUSSztIa5qEAOzZ17W3Q7gJFrz7x4wDQYJKoZIhvcNAQEL
BQAwgYUxCzAJBgNVBAYTAlNQMQ8wDQYDVQQIDAZNYWRyaWQxDzANBgNVBAcMBk1h
ZHJpZDESMBAGA1UECgwJNDItTWFkcmlkMRIwEAYDVQQDDAlsb2NhbGhvc3QxLDAq
BgkqhkiG9w0BCQEWHWpvbGl2YXJlQHN0dWRlbnQuNDJtYWRyaWQuY29tMB4XDTI1
MDgwOTE2NTQ1MFoXDTI2MDgwOTE2NTQ1MFowgYUxCzAJBgNVBAYTAlNQMQ8wDQYD
VQQIDAZNYWRyaWQxDzANBgNVBAcMBk1hZHJpZDESMBAGA1UECgwJNDItTWFkcmlk
MRIwEAYDVQQDDAlsb2NhbGhvc3QxLDAqBgkqhkiG9w0BCQEWHWpvbGl2YXJlQHN0
dWRlbnQuNDJtYWRyaWQuY29tMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEAtqNCmwtS7T+sMkG+yGrZF9XbRhkxSOAo5MPuOVcZgRfOLgW+URdfE7hOMt98
7qvIAwf38yLYB6sorp8fk4z5Cc7MgpI8aT3U/JEhkdulV2pRCiMI15xDradqPBII
hT82Uw2E/LdCXXKpMPwZi65rxkFqRwKpjlE+9w8VNXBM0GopqSfchXKV/3ykAbbv
pl3UZeDFI5HmuV4lwvg+tRAuA6FNnr/EdPoMrqV+UFdFVmvhjaGpksAJZ0RJJDnG
P7xlkigIV9jK+KqIuhABeO5dWTKs3mcaVADlXpzWqlzJLqncM94+lFt76z+hXXlE
Oj6J2wtLlNE1d16TeJA2evFGiwIDAQABo1MwUTAdBgNVHQ4EFgQUj9Nk/eVHnNIA
Dwes16JFucqgpqQwHwYDVR0jBBgwFoAUj9Nk/eVHnNIADwes16JFucqgpqQwDwYD
VR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQsFAAOCAQEAsOmBExwAct8nT5Vc7nGK
cY4Vuxt3L/ZRya8PzHWhCb42CcSpMMfPt3//EPBcZpOP1LvKX8jUg3ZKHz9XoCV+
3u14I/QbVYAIt1QqPX3tQEJAgWBo2mXVWz8m4TMr7NZL0jE2juSuE5dt0H5Ll0+T
adqIgtPNRyJi09WYVXJkL6H2cfkBfDErSYUO+4LUKCycpMy0gV6BSYtLs9BlHftR
2bLcd8sw4agY32Gh11qVA4hVOK6Mzr7DFHPpV8u7Lq63Y1WlKa9unPy1J9gyW0dM
dEHi1/59QkDfL40npRogbvnAfi8aUujN1ppYS1YQnLRHr/HOwC0olWv3yP1vo8GX
Mw==
-----END CERTIFICATE-----


# END FILE CONTENTS


# File: frontend/postcss.config.js

module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}


# END FILE CONTENTS


# File: frontend/public/register.html

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Registro ‚Äî ft_transcendence</title>
  <link rel="stylesheet" href="/tailwind.css"/>
</head>
<body class="min-h-screen bg-gradient-to-br from-black via-zinc-900 to-black text-white relative overflow-hidden">

  <!-- Acentos -->
  <div class="pointer-events-none absolute -top-24 -left-24 w-[36rem] h-[36rem] rounded-full bg-indigo-600/20 blur-3xl"></div>
  <div class="pointer-events-none absolute -bottom-32 -right-24 w-[30rem] h-[30rem] rounded-full bg-emerald-500/20 blur-3xl"></div>

  <main class="w-full min-h-screen flex items-center justify-center px-4">
    <section class="w-full max-w-md">
      <div class="bg-white/5 border border-white/10 backdrop-blur-xl rounded-2xl shadow-2xl p-8">

        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight text-center mb-6">
          <span class="bg-gradient-to-r from-indigo-300 via-sky-300 to-emerald-300 bg-clip-text text-transparent" data-translate="register-title">
            Crear cuenta
          </span>
        </h1>

        <form id="f" class="space-y-5" autocomplete="off">
          <!-- Email -->
          <div class="space-y-2">
            <label class="text-sm text-zinc-300" data-translate="field-email">Email</label>
            <input
              class="w-full p-3 rounded-xl bg-zinc-900/60 text-white placeholder-zinc-400
                     border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              name="email"
              placeholder="tu@email.com"
              type="email"
              inputmode="email"
              spellcheck="false"
              autocapitalize="none"
              autocomplete="off"
              readonly
              required
            />
          </div>

          <!-- Display name -->
          <div class="space-y-2">
            <label class="text-sm text-zinc-300" data-translate="field-display_name">Display name</label>
            <input
              class="w-full p-3 rounded-xl bg-zinc-900/60 text-white placeholder-zinc-400
                     border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              name="display_name"
              placeholder="Tu nombre p√∫blico"
              autocomplete="nickname"
              required
            />
          </div>

          <!-- Nombre y apellidos -->
          <div class="flex gap-4">
            <div class="flex-1 space-y-2">
              <label class="text-sm text-zinc-300" data-translate="field-first_name">Nombre</label>
              <input
                class="w-full p-3 rounded-xl bg-zinc-900/60 text-white placeholder-zinc-400
                       border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                name="first_name"
                placeholder="Nombre"
                autocomplete="given-name"
              />
            </div>
            <div class="flex-1 space-y-2">
              <label class="text-sm text-zinc-300" data-translate="field-last_name">Apellidos</label>
              <input
                class="w-full p-3 rounded-xl bg-zinc-900/60 text-white placeholder-zinc-400
                       border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                name="last_name"
                placeholder="Apellidos"
                autocomplete="family-name"
              />
            </div>
          </div>

          <!-- Fecha -->
          <div class="space-y-2">
            <label class="text-sm text-zinc-300" data-translate="field-birthdate">Fecha de nacimiento</label>
            <input
              class="w-full p-3 rounded-xl bg-zinc-900/60 text-white placeholder-zinc-400
                     border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              name="birthdate"
              type="date"
              autocomplete="bday"
            />
          </div>

          <!-- Contrase√±a -->
          <div class="space-y-2">
            <label class="text-sm text-zinc-300" data-translate="field-password">Contrase√±a</label>
            <div class="relative">
              <input
                id="pwd"
                class="w-full p-3 pr-12 rounded-xl bg-zinc-900/60 text-white placeholder-zinc-400
                       border border-white/10 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                name="password"
                placeholder="Contrase√±a (m√≠n. 8)"
                type="password"
                minlength="8"
                autocomplete="new-password"
                required
              />
              <button
                type="button"
                id="togglePwd"
                class="absolute inset-y-0 right-0 px-3 text-sm text-white/70 hover:text-white"
                aria-label="Mostrar u ocultar contrase√±a"
              >
                üëÅÔ∏è
              </button>
            </div>
          </div>

          <!-- Enviar -->
          <button
            id="submitBtn"
            class="w-full bg-indigo-600 hover:bg-indigo-500 active:bg-indigo-700 font-semibold py-3 rounded-xl transition
                   shadow-lg shadow-indigo-600/25
                   focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-400 focus-visible:ring-offset-black
                   disabled:opacity-60 disabled:cursor-not-allowed"
            type="submit"
            data-translate="action-register"
          >
            Registrarse
          </button>

          <div id="err" class="text-red-400 text-sm min-h-[1.25rem]"></div>
        </form>

        <a href="/" class="block text-center mt-4 underline opacity-80 hover:opacity-100" data-translate="action-back">Volver</a>
      </div>
    </section>
  </main>

  <!-- Carga api global y tu m√≥dulo TS compilado -->
  <script src="./js/api.js"></script>
  <script type="module" src="/dist/register.js"></script>
  <script type="module">
		import { initializeLanguages, changeLanguage } from '/dist/translate.js';

		document.addEventListener('DOMContentLoaded', () => {
			initializeLanguages();
		});

		window.changeLanguage = changeLanguage;
	</script>
</body>
</html>


# END FILE CONTENTS


# File: docker-compose.yml

services:
  backend:
    build: ./backend
    ports:
      - "1234:1234"
    volumes:
      - ./backend:/app
      - /app/node_modules
      - ./data:/app/data
      - ./frontend/public:/app/public
    develop:
      watch:
         - path: ./backend/src 
           action: sync
           target: /app/src
         - path: ./backend/package.json
           action: rebuild
  frontend:
    build: ./frontend
    volumes:
      - ./frontend:/app
      - /app/node_modules
    develop:
      watch:
        - path: ./frontend/src
          action: sync
          target: /app/src

# END FILE CONTENTS


# File: backend/src/routes/auth.js

const bcrypt = require('bcrypt');
const { db } = require('../db');

function toUserSafe(row){
  return {
    id: row.id, email: row.email, display_name: row.display_name,
    first_name: row.first_name, last_name: row.last_name, birthdate: row.birthdate,
    avatar_path: row.avatar_path, created_at: row.created_at, updated_at: row.updated_at
  };
}

async function routes(fastify){
  fastify.post('/api/auth/register', async (req, reply)=>{
    const { email, password, display_name, first_name, last_name, birthdate } = req.body || {};
    if(!email || !password || !display_name) return reply.code(400).send({ error: 'Missing fields' });
    if(typeof password !== 'string' || password.length < 8) return reply.code(400).send({ error: 'Weak password' });
    const hash = await bcrypt.hash(password, 10);
    try {
      const info = db.prepare(`INSERT INTO users (email, password_hash, display_name, first_name, last_name, birthdate)
        VALUES (?, ?, ?, ?, ?, ?)`)
        .run(email, hash, display_name, first_name ?? null, last_name ?? null, birthdate ?? null);
      const user = db.prepare('SELECT * FROM users WHERE id = ?').get(info.lastInsertRowid);
      req.session.uid = user.id;
      return { user: toUserSafe(user) };
    } catch (e) {
      if(e.code === 'SQLITE_CONSTRAINT_UNIQUE') return reply.code(409).send({ error: 'Email or display name already in use' });
      return reply.code(500).send({ error: 'Registration failed' });
    }
  });

  fastify.post('/api/auth/login', async (req, reply)=>{
    const { email, password } = req.body || {};
    if(!email || !password) return reply.code(400).send({ error: 'Missing credentials' });
    const user = db.prepare('SELECT * FROM users WHERE email = ?').get(email);
    if(!user) return reply.code(401).send({ error: 'Invalid email or password' });
    const ok = await bcrypt.compare(password, user.password_hash);
    if(!ok) return reply.code(401).send({ error: 'Invalid email or password' });
    req.session.uid = user.id;
    return { user: toUserSafe(user) };
  });

  fastify.post('/api/auth/logout', async (req, reply)=>{
    req.session.uid = null;
    reply.clearCookie('sessionId');
    return { ok: true };
  });

  fastify.get('/api/auth/me', async (req, reply)=>{
    const uid = req.session.uid;
    if(!uid) return reply.code(401).send({ user: null });
    const user = db.prepare('SELECT * FROM users WHERE id = ?').get(uid);
    return { user: toUserSafe(user) };
  });
}

module.exports = routes;


# END FILE CONTENTS


# File: frontend/public/tailwind.css

*, ::before, ::after {
  --tw-border-spacing-x: 0;
  --tw-border-spacing-y: 0;
  --tw-translate-x: 0;
  --tw-translate-y: 0;
  --tw-rotate: 0;
  --tw-skew-x: 0;
  --tw-skew-y: 0;
  --tw-scale-x: 1;
  --tw-scale-y: 1;
  --tw-pan-x:  ;
  --tw-pan-y:  ;
  --tw-pinch-zoom:  ;
  --tw-scroll-snap-strictness: proximity;
  --tw-gradient-from-position:  ;
  --tw-gradient-via-position:  ;
  --tw-gradient-to-position:  ;
  --tw-ordinal:  ;
  --tw-slashed-zero:  ;
  --tw-numeric-figure:  ;
  --tw-numeric-spacing:  ;
  --tw-numeric-fraction:  ;
  --tw-ring-inset:  ;
  --tw-ring-offset-width: 0px;
  --tw-ring-offset-color: #fff;
  --tw-ring-color: rgb(59 130 246 / 0.5);
  --tw-ring-offset-shadow: 0 0 #0000;
  --tw-ring-shadow: 0 0 #0000;
  --tw-shadow: 0 0 #0000;
  --tw-shadow-colored: 0 0 #0000;
  --tw-blur:  ;
  --tw-brightness:  ;
  --tw-contrast:  ;
  --tw-grayscale:  ;
  --tw-hue-rotate:  ;
  --tw-invert:  ;
  --tw-saturate:  ;
  --tw-sepia:  ;
  --tw-drop-shadow:  ;
  --tw-backdrop-blur:  ;
  --tw-backdrop-brightness:  ;
  --tw-backdrop-contrast:  ;
  --tw-backdrop-grayscale:  ;
  --tw-backdrop-hue-rotate:  ;
  --tw-backdrop-invert:  ;
  --tw-backdrop-opacity:  ;
  --tw-backdrop-saturate:  ;
  --tw-backdrop-sepia:  ;
  --tw-contain-size:  ;
  --tw-contain-layout:  ;
  --tw-contain-paint:  ;
  --tw-contain-style:  ;
}

::backdrop {
  --tw-border-spacing-x: 0;
  --tw-border-spacing-y: 0;
  --tw-translate-x: 0;
  --tw-translate-y: 0;
  --tw-rotate: 0;
  --tw-skew-x: 0;
  --tw-skew-y: 0;
  --tw-scale-x: 1;
  --tw-scale-y: 1;
  --tw-pan-x:  ;
  --tw-pan-y:  ;
  --tw-pinch-zoom:  ;
  --tw-scroll-snap-strictness: proximity;
  --tw-gradient-from-position:  ;
  --tw-gradient-via-position:  ;
  --tw-gradient-to-position:  ;
  --tw-ordinal:  ;
  --tw-slashed-zero:  ;
  --tw-numeric-figure:  ;
  --tw-numeric-spacing:  ;
  --tw-numeric-fraction:  ;
  --tw-ring-inset:  ;
  --tw-ring-offset-width: 0px;
  --tw-ring-offset-color: #fff;
  --tw-ring-color: rgb(59 130 246 / 0.5);
  --tw-ring-offset-shadow: 0 0 #0000;
  --tw-ring-shadow: 0 0 #0000;
  --tw-shadow: 0 0 #0000;
  --tw-shadow-colored: 0 0 #0000;
  --tw-blur:  ;
  --tw-brightness:  ;
  --tw-contrast:  ;
  --tw-grayscale:  ;
  --tw-hue-rotate:  ;
  --tw-invert:  ;
  --tw-saturate:  ;
  --tw-sepia:  ;
  --tw-drop-shadow:  ;
  --tw-backdrop-blur:  ;
  --tw-backdrop-brightness:  ;
  --tw-backdrop-contrast:  ;
  --tw-backdrop-grayscale:  ;
  --tw-backdrop-hue-rotate:  ;
  --tw-backdrop-invert:  ;
  --tw-backdrop-opacity:  ;
  --tw-backdrop-saturate:  ;
  --tw-backdrop-sepia:  ;
  --tw-contain-size:  ;
  --tw-contain-layout:  ;
  --tw-contain-paint:  ;
  --tw-contain-style:  ;
}

/*
! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com
*/

/*
1. Prevent padding and border from affecting element width. (https://github.com/mozdevs/cssremedy/issues/4)
2. Allow adding a border to an element by just adding a border-width. (https://github.com/tailwindcss/tailwindcss/pull/116)
*/

*,
::before,
::after {
  box-sizing: border-box;
  /* 1 */
  border-width: 0;
  /* 2 */
  border-style: solid;
  /* 2 */
  border-color: #e5e7eb;
  /* 2 */
}

::before,
::after {
  --tw-content: '';
}

/*
1. Use a consistent sensible line-height in all browsers.
2. Prevent adjustments of font size after orientation changes in iOS.
3. Use a more readable tab size.
4. Use the user's configured `sans` font-family by default.
5. Use the user's configured `sans` font-feature-settings by default.
6. Use the user's configured `sans` font-variation-settings by default.
7. Disable tap highlights on iOS
*/

html,
:host {
  line-height: 1.5;
  /* 1 */
  -webkit-text-size-adjust: 100%;
  /* 2 */
  -moz-tab-size: 4;
  /* 3 */
  -o-tab-size: 4;
     tab-size: 4;
  /* 3 */
  font-family: ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
  /* 4 */
  font-feature-settings: normal;
  /* 5 */
  font-variation-settings: normal;
  /* 6 */
  -webkit-tap-highlight-color: transparent;
  /* 7 */
}

/*
1. Remove the margin in all browsers.
2. Inherit line-height from `html` so users can set them as a class directly on the `html` element.
*/

body {
  margin: 0;
  /* 1 */
  line-height: inherit;
  /* 2 */
}

/*
1. Add the correct height in Firefox.
2. Correct the inheritance of border color in Firefox. (https://bugzilla.mozilla.org/show_bug.cgi?id=190655)
3. Ensure horizontal rules are visible by default.
*/

hr {
  height: 0;
  /* 1 */
  color: inherit;
  /* 2 */
  border-top-width: 1px;
  /* 3 */
}

/*
Add the correct text decoration in Chrome, Edge, and Safari.
*/

abbr:where([title]) {
  -webkit-text-decoration: underline dotted;
          text-decoration: underline dotted;
}

/*
Remove the default font size and weight for headings.
*/

h1,
h2,
h3,
h4,
h5,
h6 {
  font-size: inherit;
  font-weight: inherit;
}

/*
Reset links to optimize for opt-in styling instead of opt-out.
*/

a {
  color: inherit;
  text-decoration: inherit;
}

/*
Add the correct font weight in Edge and Safari.
*/

b,
strong {
  font-weight: bolder;
}

/*
1. Use the user's configured `mono` font-family by default.
2. Use the user's configured `mono` font-feature-settings by default.
3. Use the user's configured `mono` font-variation-settings by default.
4. Correct the odd `em` font sizing in all browsers.
*/

code,
kbd,
samp,
pre {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  /* 1 */
  font-feature-settings: normal;
  /* 2 */
  font-variation-settings: normal;
  /* 3 */
  font-size: 1em;
  /* 4 */
}

/*
Add the correct font size in all browsers.
*/

small {
  font-size: 80%;
}

/*
Prevent `sub` and `sup` elements from affecting the line height in all browsers.
*/

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sub {
  bottom: -0.25em;
}

sup {
  top: -0.5em;
}

/*
1. Remove text indentation from table contents in Chrome and Safari. (https://bugs.chromium.org/p/chromium/issues/detail?id=999088, https://bugs.webkit.org/show_bug.cgi?id=201297)
2. Correct table border color inheritance in all Chrome and Safari. (https://bugs.chromium.org/p/chromium/issues/detail?id=935729, https://bugs.webkit.org/show_bug.cgi?id=195016)
3. Remove gaps between table borders by default.
*/

table {
  text-indent: 0;
  /* 1 */
  border-color: inherit;
  /* 2 */
  border-collapse: collapse;
  /* 3 */
}

/*
1. Change the font styles in all browsers.
2. Remove the margin in Firefox and Safari.
3. Remove default padding in all browsers.
*/

button,
input,
optgroup,
select,
textarea {
  font-family: inherit;
  /* 1 */
  font-feature-settings: inherit;
  /* 1 */
  font-variation-settings: inherit;
  /* 1 */
  font-size: 100%;
  /* 1 */
  font-weight: inherit;
  /* 1 */
  line-height: inherit;
  /* 1 */
  letter-spacing: inherit;
  /* 1 */
  color: inherit;
  /* 1 */
  margin: 0;
  /* 2 */
  padding: 0;
  /* 3 */
}

/*
Remove the inheritance of text transform in Edge and Firefox.
*/

button,
select {
  text-transform: none;
}

/*
1. Correct the inability to style clickable types in iOS and Safari.
2. Remove default button styles.
*/

button,
input:where([type='button']),
input:where([type='reset']),
input:where([type='submit']) {
  -webkit-appearance: button;
  /* 1 */
  background-color: transparent;
  /* 2 */
  background-image: none;
  /* 2 */
}

/*
Use the modern Firefox focus style for all focusable elements.
*/

:-moz-focusring {
  outline: auto;
}

/*
Remove the additional `:invalid` styles in Firefox. (https://github.com/mozilla/gecko-dev/blob/2f9eacd9d3d995c937b4251a5557d95d494c9be1/layout/style/res/forms.css#L728-L737)
*/

:-moz-ui-invalid {
  box-shadow: none;
}

/*
Add the correct vertical alignment in Chrome and Firefox.
*/

progress {
  vertical-align: baseline;
}

/*
Correct the cursor style of increment and decrement buttons in Safari.
*/

::-webkit-inner-spin-button,
::-webkit-outer-spin-button {
  height: auto;
}

/*
1. Correct the odd appearance in Chrome and Safari.
2. Correct the outline style in Safari.
*/

[type='search'] {
  -webkit-appearance: textfield;
  /* 1 */
  outline-offset: -2px;
  /* 2 */
}

/*
Remove the inner padding in Chrome and Safari on macOS.
*/

::-webkit-search-decoration {
  -webkit-appearance: none;
}

/*
1. Correct the inability to style clickable types in iOS and Safari.
2. Change font properties to `inherit` in Safari.
*/

::-webkit-file-upload-button {
  -webkit-appearance: button;
  /* 1 */
  font: inherit;
  /* 2 */
}

/*
Add the correct display in Chrome and Safari.
*/

summary {
  display: list-item;
}

/*
Removes the default spacing and border for appropriate elements.
*/

blockquote,
dl,
dd,
h1,
h2,
h3,
h4,
h5,
h6,
hr,
figure,
p,
pre {
  margin: 0;
}

fieldset {
  margin: 0;
  padding: 0;
}

legend {
  padding: 0;
}

ol,
ul,
menu {
  list-style: none;
  margin: 0;
  padding: 0;
}

/*
Reset default styling for dialogs.
*/

dialog {
  padding: 0;
}

/*
Prevent resizing textareas horizontally by default.
*/

textarea {
  resize: vertical;
}

/*
1. Reset the default placeholder opacity in Firefox. (https://github.com/tailwindlabs/tailwindcss/issues/3300)
2. Set the default placeholder color to the user's configured gray 400 color.
*/

input::-moz-placeholder, textarea::-moz-placeholder {
  opacity: 1;
  /* 1 */
  color: #9ca3af;
  /* 2 */
}

input::placeholder,
textarea::placeholder {
  opacity: 1;
  /* 1 */
  color: #9ca3af;
  /* 2 */
}

/*
Set the default cursor for buttons.
*/

button,
[role="button"] {
  cursor: pointer;
}

/*
Make sure disabled buttons don't get the pointer cursor.
*/

:disabled {
  cursor: default;
}

/*
1. Make replaced elements `display: block` by default. (https://github.com/mozdevs/cssremedy/issues/14)
2. Add `vertical-align: middle` to align replaced elements more sensibly by default. (https://github.com/jensimmons/cssremedy/issues/14#issuecomment-634934210)
   This can trigger a poorly considered lint error in some tools but is included by design.
*/

img,
svg,
video,
canvas,
audio,
iframe,
embed,
object {
  display: block;
  /* 1 */
  vertical-align: middle;
  /* 2 */
}

/*
Constrain images and videos to the parent width and preserve their intrinsic aspect ratio. (https://github.com/mozdevs/cssremedy/issues/14)
*/

img,
video {
  max-width: 100%;
  height: auto;
}

/* Make elements with the HTML hidden attribute stay hidden by default */

[hidden]:where(:not([hidden="until-found"])) {
  display: none;
}

.pointer-events-none {
  pointer-events: none;
}

.fixed {
  position: fixed;
}

.absolute {
  position: absolute;
}

.relative {
  position: relative;
}

.inset-0 {
  inset: 0px;
}

.inset-y-0 {
  top: 0px;
  bottom: 0px;
}

.-bottom-32 {
  bottom: -8rem;
}

.-left-24 {
  left: -6rem;
}

.-right-24 {
  right: -6rem;
}

.-top-24 {
  top: -6rem;
}

.right-0 {
  right: 0px;
}

.right-4 {
  right: 1rem;
}

.top-4 {
  top: 1rem;
}

.z-50 {
  z-index: 50;
}

.z-\[60\] {
  z-index: 60;
}

.mx-1 {
  margin-left: 0.25rem;
  margin-right: 0.25rem;
}

.mx-2 {
  margin-left: 0.5rem;
  margin-right: 0.5rem;
}

.mb-10 {
  margin-bottom: 2.5rem;
}

.mb-2 {
  margin-bottom: 0.5rem;
}

.mb-4 {
  margin-bottom: 1rem;
}

.mb-6 {
  margin-bottom: 1.5rem;
}

.mb-8 {
  margin-bottom: 2rem;
}

.mt-2 {
  margin-top: 0.5rem;
}

.mt-4 {
  margin-top: 1rem;
}

.mt-6 {
  margin-top: 1.5rem;
}

.block {
  display: block;
}

.flex {
  display: flex;
}

.inline-flex {
  display: inline-flex;
}

.size-10 {
  width: 2.5rem;
  height: 2.5rem;
}

.h-\[30rem\] {
  height: 30rem;
}

.h-\[36rem\] {
  height: 36rem;
}

.h-screen {
  height: 100vh;
}

.min-h-\[1\.25rem\] {
  min-height: 1.25rem;
}

.min-h-screen {
  min-height: 100vh;
}

.w-1\/2 {
  width: 50%;
}

.w-\[30rem\] {
  width: 30rem;
}

.w-\[36rem\] {
  width: 36rem;
}

.w-\[520px\] {
  width: 520px;
}

.w-full {
  width: 100%;
}

.max-w-md {
  max-width: 28rem;
}

.flex-1 {
  flex: 1 1 0%;
}

.flex-col {
  flex-direction: column;
}

.items-center {
  align-items: center;
}

.justify-center {
  justify-content: center;
}

.justify-between {
  justify-content: space-between;
}

.gap-2 {
  gap: 0.5rem;
}

.gap-3 {
  gap: 0.75rem;
}

.gap-4 {
  gap: 1rem;
}

.gap-6 {
  gap: 1.5rem;
}

.space-y-2 > :not([hidden]) ~ :not([hidden]) {
  --tw-space-y-reverse: 0;
  margin-top: calc(0.5rem * calc(1 - var(--tw-space-y-reverse)));
  margin-bottom: calc(0.5rem * var(--tw-space-y-reverse));
}

.space-y-3 > :not([hidden]) ~ :not([hidden]) {
  --tw-space-y-reverse: 0;
  margin-top: calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));
  margin-bottom: calc(0.75rem * var(--tw-space-y-reverse));
}

.space-y-4 > :not([hidden]) ~ :not([hidden]) {
  --tw-space-y-reverse: 0;
  margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse)));
  margin-bottom: calc(1rem * var(--tw-space-y-reverse));
}

.space-y-5 > :not([hidden]) ~ :not([hidden]) {
  --tw-space-y-reverse: 0;
  margin-top: calc(1.25rem * calc(1 - var(--tw-space-y-reverse)));
  margin-bottom: calc(1.25rem * var(--tw-space-y-reverse));
}

.space-y-6 > :not([hidden]) ~ :not([hidden]) {
  --tw-space-y-reverse: 0;
  margin-top: calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));
  margin-bottom: calc(1.5rem * var(--tw-space-y-reverse));
}

.overflow-hidden {
  overflow: hidden;
}

.rounded {
  border-radius: 0.25rem;
}

.rounded-2xl {
  border-radius: 1rem;
}

.rounded-full {
  border-radius: 9999px;
}

.rounded-lg {
  border-radius: 0.5rem;
}

.rounded-xl {
  border-radius: 0.75rem;
}

.border {
  border-width: 1px;
}

.border-4 {
  border-width: 4px;
}

.border-white {
  --tw-border-opacity: 1;
  border-color: rgb(255 255 255 / var(--tw-border-opacity, 1));
}

.border-white\/10 {
  border-color: rgb(255 255 255 / 0.1);
}

.bg-black {
  --tw-bg-opacity: 1;
  background-color: rgb(0 0 0 / var(--tw-bg-opacity, 1));
}

.bg-blue-500 {
  --tw-bg-opacity: 1;
  background-color: rgb(59 130 246 / var(--tw-bg-opacity, 1));
}

.bg-emerald-500\/20 {
  background-color: rgb(16 185 129 / 0.2);
}

.bg-gray-800 {
  --tw-bg-opacity: 1;
  background-color: rgb(31 41 55 / var(--tw-bg-opacity, 1));
}

.bg-gray-900 {
  --tw-bg-opacity: 1;
  background-color: rgb(17 24 39 / var(--tw-bg-opacity, 1));
}

.bg-green-500 {
  --tw-bg-opacity: 1;
  background-color: rgb(34 197 94 / var(--tw-bg-opacity, 1));
}

.bg-green-600 {
  --tw-bg-opacity: 1;
  background-color: rgb(22 163 74 / var(--tw-bg-opacity, 1));
}

.bg-indigo-500 {
  --tw-bg-opacity: 1;
  background-color: rgb(99 102 241 / var(--tw-bg-opacity, 1));
}

.bg-indigo-600 {
  --tw-bg-opacity: 1;
  background-color: rgb(79 70 229 / var(--tw-bg-opacity, 1));
}

.bg-indigo-600\/20 {
  background-color: rgb(79 70 229 / 0.2);
}

.bg-purple-500 {
  --tw-bg-opacity: 1;
  background-color: rgb(168 85 247 / var(--tw-bg-opacity, 1));
}

.bg-red-600 {
  --tw-bg-opacity: 1;
  background-color: rgb(220 38 38 / var(--tw-bg-opacity, 1));
}

.bg-white\/10 {
  background-color: rgb(255 255 255 / 0.1);
}

.bg-white\/5 {
  background-color: rgb(255 255 255 / 0.05);
}

.bg-yellow-500 {
  --tw-bg-opacity: 1;
  background-color: rgb(234 179 8 / var(--tw-bg-opacity, 1));
}

.bg-zinc-800 {
  --tw-bg-opacity: 1;
  background-color: rgb(39 39 42 / var(--tw-bg-opacity, 1));
}

.bg-zinc-800\/60 {
  background-color: rgb(39 39 42 / 0.6);
}

.bg-zinc-900 {
  --tw-bg-opacity: 1;
  background-color: rgb(24 24 27 / var(--tw-bg-opacity, 1));
}

.bg-zinc-900\/60 {
  background-color: rgb(24 24 27 / 0.6);
}

.bg-opacity-80 {
  --tw-bg-opacity: 0.8;
}

.bg-gradient-to-br {
  background-image: linear-gradient(to bottom right, var(--tw-gradient-stops));
}

.bg-gradient-to-r {
  background-image: linear-gradient(to right, var(--tw-gradient-stops));
}

.from-black {
  --tw-gradient-from: #000 var(--tw-gradient-from-position);
  --tw-gradient-to: rgb(0 0 0 / 0) var(--tw-gradient-to-position);
  --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
}

.from-indigo-300 {
  --tw-gradient-from: #a5b4fc var(--tw-gradient-from-position);
  --tw-gradient-to: rgb(165 180 252 / 0) var(--tw-gradient-to-position);
  --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
}

.from-indigo-400 {
  --tw-gradient-from: #818cf8 var(--tw-gradient-from-position);
  --tw-gradient-to: rgb(129 140 248 / 0) var(--tw-gradient-to-position);
  --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to);
}

.via-sky-300 {
  --tw-gradient-to: rgb(125 211 252 / 0)  var(--tw-gradient-to-position);
  --tw-gradient-stops: var(--tw-gradient-from), #7dd3fc var(--tw-gradient-via-position), var(--tw-gradient-to);
}

.via-zinc-900 {
  --tw-gradient-to: rgb(24 24 27 / 0)  var(--tw-gradient-to-position);
  --tw-gradient-stops: var(--tw-gradient-from), #18181b var(--tw-gradient-via-position), var(--tw-gradient-to);
}

.to-black {
  --tw-gradient-to: #000 var(--tw-gradient-to-position);
}

.to-emerald-300 {
  --tw-gradient-to: #6ee7b7 var(--tw-gradient-to-position);
}

.to-emerald-400 {
  --tw-gradient-to: #34d399 var(--tw-gradient-to-position);
}

.bg-clip-text {
  -webkit-background-clip: text;
          background-clip: text;
}

.p-2 {
  padding: 0.5rem;
}

.p-3 {
  padding: 0.75rem;
}

.p-6 {
  padding: 1.5rem;
}

.p-8 {
  padding: 2rem;
}

.px-3 {
  padding-left: 0.75rem;
  padding-right: 0.75rem;
}

.px-4 {
  padding-left: 1rem;
  padding-right: 1rem;
}

.px-6 {
  padding-left: 1.5rem;
  padding-right: 1.5rem;
}

.py-1\.5 {
  padding-top: 0.375rem;
  padding-bottom: 0.375rem;
}

.py-2 {
  padding-top: 0.5rem;
  padding-bottom: 0.5rem;
}

.py-3 {
  padding-top: 0.75rem;
  padding-bottom: 0.75rem;
}

.pr-12 {
  padding-right: 3rem;
}

.text-center {
  text-align: center;
}

.font-mono {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}

.text-2xl {
  font-size: 1.5rem;
  line-height: 2rem;
}

.text-3xl {
  font-size: 1.875rem;
  line-height: 2.25rem;
}

.text-4xl {
  font-size: 2.25rem;
  line-height: 2.5rem;
}

.text-base {
  font-size: 1rem;
  line-height: 1.5rem;
}

.text-lg {
  font-size: 1.125rem;
  line-height: 1.75rem;
}

.text-sm {
  font-size: 0.875rem;
  line-height: 1.25rem;
}

.text-sm\/none {
  font-size: 0.875rem;
  line-height: 1;
}

.text-xl {
  font-size: 1.25rem;
  line-height: 1.75rem;
}

.text-xs {
  font-size: 0.75rem;
  line-height: 1rem;
}

.font-bold {
  font-weight: 700;
}

.font-extrabold {
  font-weight: 800;
}

.font-medium {
  font-weight: 500;
}

.font-semibold {
  font-weight: 600;
}

.tracking-tight {
  letter-spacing: -0.025em;
}

.text-indigo-400 {
  --tw-text-opacity: 1;
  color: rgb(129 140 248 / var(--tw-text-opacity, 1));
}

.text-red-400 {
  --tw-text-opacity: 1;
  color: rgb(248 113 113 / var(--tw-text-opacity, 1));
}

.text-transparent {
  color: transparent;
}

.text-white {
  --tw-text-opacity: 1;
  color: rgb(255 255 255 / var(--tw-text-opacity, 1));
}

.text-white\/50 {
  color: rgb(255 255 255 / 0.5);
}

.text-white\/70 {
  color: rgb(255 255 255 / 0.7);
}

.text-zinc-300 {
  --tw-text-opacity: 1;
  color: rgb(212 212 216 / var(--tw-text-opacity, 1));
}

.text-zinc-400 {
  --tw-text-opacity: 1;
  color: rgb(161 161 170 / var(--tw-text-opacity, 1));
}

.underline {
  text-decoration-line: underline;
}

.placeholder-zinc-400::-moz-placeholder {
  --tw-placeholder-opacity: 1;
  color: rgb(161 161 170 / var(--tw-placeholder-opacity, 1));
}

.placeholder-zinc-400::placeholder {
  --tw-placeholder-opacity: 1;
  color: rgb(161 161 170 / var(--tw-placeholder-opacity, 1));
}

.opacity-70 {
  opacity: 0.7;
}

.opacity-80 {
  opacity: 0.8;
}

.shadow {
  --tw-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
  --tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);
  box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
}

.shadow-2xl {
  --tw-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
  --tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color);
  box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
}

.shadow-lg {
  --tw-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);
  box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);
}

.shadow-indigo-600\/25 {
  --tw-shadow-color: rgb(79 70 229 / 0.25);
  --tw-shadow: var(--tw-shadow-colored);
}

.outline-none {
  outline: 2px solid transparent;
  outline-offset: 2px;
}

.ring-1 {
  --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
  --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);
  box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
}

.ring-zinc-700 {
  --tw-ring-opacity: 1;
  --tw-ring-color: rgb(63 63 70 / var(--tw-ring-opacity, 1));
}

.blur {
  --tw-blur: blur(8px);
  filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);
}

.blur-3xl {
  --tw-blur: blur(64px);
  filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow);
}

.backdrop-blur {
  --tw-backdrop-blur: blur(8px);
  backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);
}

.backdrop-blur-xl {
  --tw-backdrop-blur: blur(24px);
  backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia);
}

.transition {
  transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 150ms;
}

@keyframes fade-in {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

.animate-fade-in {
  animation: fade-in 0.4s ease-out forwards;
}

@keyframes fade-out {
  from {
    opacity: 1;
  }

  to {
    opacity: 0;
  }
}

.animate-fade-out {
  animation: fade-out 0.4s ease-out forwards;
  pointer-events: none;
}

@keyframes zoom-into-game {
  0% {
    transform: scale(1);
    opacity: 1;
  }

  100% {
    transform: scale(20);
    opacity: 0;
  }
}

.zoom-into-game {
  animation: zoom-into-game 0.5s ease-out forwards;
  z-index: 50;
}

.hover\:bg-blue-600:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(37 99 235 / var(--tw-bg-opacity, 1));
}

.hover\:bg-green-600:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(22 163 74 / var(--tw-bg-opacity, 1));
}

.hover\:bg-green-700:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(21 128 61 / var(--tw-bg-opacity, 1));
}

.hover\:bg-indigo-500:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(99 102 241 / var(--tw-bg-opacity, 1));
}

.hover\:bg-indigo-600:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(79 70 229 / var(--tw-bg-opacity, 1));
}

.hover\:bg-indigo-700:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(67 56 202 / var(--tw-bg-opacity, 1));
}

.hover\:bg-purple-600:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(147 51 234 / var(--tw-bg-opacity, 1));
}

.hover\:bg-red-700:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(185 28 28 / var(--tw-bg-opacity, 1));
}

.hover\:bg-white\/15:hover {
  background-color: rgb(255 255 255 / 0.15);
}

.hover\:bg-yellow-600:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(202 138 4 / var(--tw-bg-opacity, 1));
}

.hover\:bg-zinc-800:hover {
  --tw-bg-opacity: 1;
  background-color: rgb(39 39 42 / var(--tw-bg-opacity, 1));
}

.hover\:text-indigo-300:hover {
  --tw-text-opacity: 1;
  color: rgb(165 180 252 / var(--tw-text-opacity, 1));
}

.hover\:text-white:hover {
  --tw-text-opacity: 1;
  color: rgb(255 255 255 / var(--tw-text-opacity, 1));
}

.hover\:underline:hover {
  text-decoration-line: underline;
}

.hover\:opacity-100:hover {
  opacity: 1;
}

.focus\:border-indigo-500:focus {
  --tw-border-opacity: 1;
  border-color: rgb(99 102 241 / var(--tw-border-opacity, 1));
}

.focus\:outline-none:focus {
  outline: 2px solid transparent;
  outline-offset: 2px;
}

.focus\:ring-2:focus {
  --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
  --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
  box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
}

.focus\:ring-indigo-500:focus {
  --tw-ring-opacity: 1;
  --tw-ring-color: rgb(99 102 241 / var(--tw-ring-opacity, 1));
}

.focus-visible\:outline-none:focus-visible {
  outline: 2px solid transparent;
  outline-offset: 2px;
}

.focus-visible\:ring-2:focus-visible {
  --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);
  --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color);
  box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000);
}

.focus-visible\:ring-indigo-400:focus-visible {
  --tw-ring-opacity: 1;
  --tw-ring-color: rgb(129 140 248 / var(--tw-ring-opacity, 1));
}

.focus-visible\:ring-white\/40:focus-visible {
  --tw-ring-color: rgb(255 255 255 / 0.4);
}

.focus-visible\:ring-offset-2:focus-visible {
  --tw-ring-offset-width: 2px;
}

.focus-visible\:ring-offset-black:focus-visible {
  --tw-ring-offset-color: #000;
}

.active\:bg-indigo-700:active {
  --tw-bg-opacity: 1;
  background-color: rgb(67 56 202 / var(--tw-bg-opacity, 1));
}

.active\:bg-white\/20:active {
  background-color: rgb(255 255 255 / 0.2);
}

.disabled\:cursor-not-allowed:disabled {
  cursor: not-allowed;
}

.disabled\:opacity-60:disabled {
  opacity: 0.6;
}

@media (min-width: 640px) {
  .sm\:flex-row {
    flex-direction: row;
  }
}

@media (min-width: 768px) {
  .md\:text-4xl {
    font-size: 2.25rem;
    line-height: 2.5rem;
  }
}



# END FILE CONTENTS


# File: frontend/public/locales/en.json

{
  "play_1v1": "Play 1v1",
  "play_ai": "Play vs AI",
  "select_difficulty": "Select difficulty",
  "easy": "easy",
  "medium": "medium",
  "hard": "hard",
  "game_over": "Game Over",
  "press_space_start": "Press space to start",
  "press_space_restart": "Press space to restart",
  "field-email": "Email",
  "field-display_name": "Display Name",
  "field-first_name": "Name",
  "field-last_name": "Last Name",
  "field-birthdate": "Date of birth",
  "field-password": "Password",
  "action-register": "register"
}

# END FILE CONTENTS


# File: frontend/public/menu.html

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ft_Transcendence</title>
  <link rel="stylesheet" href="/tailwind.css" />
  <script src="/dist/translate.js" type="module" defer></script>
</head>
<body class="bg-black text-white flex flex-col items-center justify-center min-h-screen">

    <div class="language-selector absolute top-4 right-4 text-sm">
        <button class="hover:underline" onclick="changeLanguage?.('en')">EN</button>
        <span class="mx-1">|</span>
        <button class="hover:underline" onclick="changeLanguage?.('es')">ES</button>
        <span class="mx-1">|</span>
        <button class="hover:underline" onclick="changeLanguage?.('fr')">FR</button>
    </div>
    
  <h1 class="text-4xl font-bold mb-10">Ft_Transcendence</h1>

  <div class="flex flex-col gap-4">
        <a id="play-1v1-btn" href="game.html" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded text-xl transition game-link flex justify-center" data-translate="play_1v1">Jugar 1v1</a>
        
        <a id="play-ai-btn" href="game.html?mode=ai" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded text-xl transition game-link flex justify-center" data-translate="play_ai">Jugar contra IA</a>
  </div>

</body>
</html>

# END FILE CONTENTS


# File: frontend/public/js/api.js

async function api(path, opts = {}){
  const res = await fetch(path, Object.assign({ credentials: 'include', headers: { 'Content-Type': 'application/json' }}, opts));
  if(!res.ok){
    let msg = res.statusText;
    try{ const j = await res.json(); if(j && j.error) msg = j.error; }catch{}
    throw new Error(msg);
  }
  return res.json();
}
window.api = api;


# END FILE CONTENTS


# File: backend/src/routes/friends.js

const { db } = require('../db');

async function routes(fastify){
  fastify.post('/api/friends/:userId', async (req, reply)=>{
    const uid = req.session.uid;
    if(!uid) return reply.code(401).send({ error: 'Unauthorized' });
    const { userId } = req.params;
    if(+userId === +uid) return reply.code(400).send({ error: 'Cannot friend yourself' });
    try{
      db.prepare('INSERT INTO friends (requester_id, addressee_id, status) VALUES (?, ?, "pending")').run(uid, userId);
      return { ok: true };
    }catch(e){
      return reply.code(409).send({ error: 'Already requested or friends' });
    }
  });

  fastify.post('/api/friends/:userId/accept', async (req, reply)=>{
    const uid = req.session.uid;
    if(!uid) return reply.code(401).send({ error: 'Unauthorized' });
    const { userId } = req.params;
    const res = db.prepare('UPDATE friends SET status = "accepted" WHERE requester_id = ? AND addressee_id = ?').run(userId, uid);
    if(res.changes === 0) return reply.code(404).send({ error: 'Request not found' });
    return { ok: true };
  });

  fastify.get('/api/friends', async (req, reply)=>{
    const uid = req.session.uid;
    if(!uid) return reply.code(401).send({ error: 'Unauthorized' });
    const rows = db.prepare(`
      SELECT u.id, u.display_name, u.avatar_path
      FROM users u
      WHERE u.id IN (
        SELECT CASE WHEN requester_id = ? THEN addressee_id ELSE requester_id END
        FROM friends
        WHERE (requester_id = ? OR addressee_id = ?) AND status = 'accepted'
      )
    `).all(uid, uid, uid);
    return { friends: rows.map(r => ({ ...r, online: false })) };
  });
}

module.exports = routes;


# END FILE CONTENTS


# File: backend/src/db.js

const Database = require('better-sqlite3');
const fs = require('fs');
const path = require('path');

const dataDir = path.join('/app','data');
fs.mkdirSync(dataDir, { recursive: true });
const dbPath = path.join(dataDir, 'app.db');
const db = new Database(dbPath);

const schema = fs.readFileSync(path.join(__dirname, 'schema.sql'), 'utf8');
db.exec(schema);

try {
  db.exec(`CREATE TRIGGER IF NOT EXISTS users_updated_at
    AFTER UPDATE ON users
    BEGIN
      UPDATE users SET updated_at = datetime('now') WHERE id = NEW.id;
    END;`);
} catch {}

module.exports = { db };


# END FILE CONTENTS


# File: frontend/tailwind.config.js

/** @type {import('tailwindcss').Config} */
module.exports = {
	content: [
		"./public/**/*.html",
		"./src/**/*.ts",
	],
	theme: {
		extend: {},
	},
	plugins: [],
};

# END FILE CONTENTS


# File: frontend/tsconfig.json

{
  "compilerOptions": {
    "target": "ES6",
    "module": "ES6",
    "lib": ["ES2019", "DOM", "DOM.Iterable"],
    "outDir": "public/dist",
    "rootDir": "src",
    "moduleResolution": "node",
    "esModuleInterop": true,
    "strict": true,
    "noEmitOnError": true,
    "isolatedModules": false
  },
  "include": ["src/**/*"]
}


# END FILE CONTENTS


# File: backend/src/schema.sql

PRAGMA journal_mode=WAL;
CREATE TABLE IF NOT EXISTS users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  email TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  display_name TEXT UNIQUE NOT NULL,
  first_name TEXT,
  last_name TEXT,
  birthdate TEXT,
  avatar_path TEXT DEFAULT '/uploads/default-avatar.png',
  created_at TEXT DEFAULT (datetime('now')),
  updated_at TEXT DEFAULT (datetime('now'))
);
CREATE TABLE IF NOT EXISTS friends (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  requester_id INTEGER NOT NULL,
  addressee_id INTEGER NOT NULL,
  status TEXT NOT NULL CHECK(status IN ('pending','accepted','blocked')),
  created_at TEXT DEFAULT (datetime('now')),
  UNIQUE(requester_id, addressee_id)
);
CREATE TABLE IF NOT EXISTS matches (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  player1_id INTEGER NOT NULL,
  player2_id INTEGER NOT NULL,
  winner_id INTEGER,
  played_at TEXT DEFAULT (datetime('now')),
  details TEXT
);


# END FILE CONTENTS


# File: backend/src/routes/users.js

const path = require('path');
const fs = require('fs');
const { db } = require('../db');

function toUserSafe(row){
  return {
    id: row.id, email: row.email, display_name: row.display_name,
    first_name: row.first_name, last_name: row.last_name, birthdate: row.birthdate,
    avatar_path: row.avatar_path, created_at: row.created_at, updated_at: row.updated_at
  };
}

async function routes(fastify){
  fastify.put('/api/users/me', async (req, reply)=>{
    const uid = req.session.uid;
    if(!uid) return reply.code(401).send({ error: 'Unauthorized' });
    const { display_name, first_name, last_name, birthdate } = req.body || {};
    try{
      db.prepare(`UPDATE users SET display_name = COALESCE(?, display_name),
        first_name = COALESCE(?, first_name), last_name = COALESCE(?, last_name), birthdate = COALESCE(?, birthdate)
        WHERE id = ?`).run(display_name ?? null, first_name ?? null, last_name ?? null, birthdate ?? null, uid);
    }catch(e){
      if(e.code === 'SQLITE_CONSTRAINT_UNIQUE') return reply.code(409).send({ error: 'Display name already in use' });
      return reply.code(500).send({ error: 'Update failed' });
    }
    const user = db.prepare('SELECT * FROM users WHERE id = ?').get(uid);
    return { user: toUserSafe(user) };
  });

  fastify.post('/api/users/me/avatar', async (req, reply)=>{
    const uid = req.session.uid;
    if(!uid) return reply.code(401).send({ error: 'Unauthorized' });
    const parts = req.parts();
    for await (const part of parts){
      if(part.type === 'file' && part.fieldname === 'avatar'){
        const filename = `u${uid}-${Date.now()}-${part.filename}`.replace(/[^a-zA-Z0-9_.-]/g, '_');
        const dest = path.join('/app/data/uploads', filename);
        await fs.promises.mkdir(path.dirname(dest), { recursive: true });
        await fs.promises.writeFile(dest, await part.toBuffer());
        db.prepare('UPDATE users SET avatar_path = ? WHERE id = ?').run(`/uploads/${filename}`, uid);
      }
    }
    const user = db.prepare('SELECT * FROM users WHERE id = ?').get(uid);
    return { user: toUserSafe(user) };
  });

  fastify.get('/api/users/:id', async (req, reply)=>{
    const { id } = req.params;
    const user = db.prepare('SELECT * FROM users WHERE id = ?').get(id);
    if(!user) return reply.code(404).send({ error: 'Not found' });
    const wins = db.prepare('SELECT COUNT(*) as c FROM matches WHERE winner_id = ?').get(id).c;
    const total = db.prepare('SELECT COUNT(*) as c FROM matches WHERE player1_id = ? OR player2_id = ?').get(id, id).c;
    const losses = Math.max(0, total - wins);
    return { user: toUserSafe(user), stats: { wins, losses } };
  });

  fastify.get('/api/users/me/matches', async (req, reply)=>{
    const uid = req.session.uid;
    if(!uid) return reply.code(401).send({ error: 'Unauthorized' });
    const rows = db.prepare(`SELECT * FROM matches WHERE player1_id = ? OR player2_id = ? ORDER BY played_at DESC LIMIT 100`).all(uid, uid);
    return { matches: rows };
  });
}

module.exports = routes;


# END FILE CONTENTS


# File: Makefile

# ==============================================================================
# ‚öôÔ∏è Configuraci√≥n
# ==============================================================================
DC ?= docker compose
PROJECT := ft_transcendence
COMPOSE_FILES := -f docker-compose.yml

# ==============================================================================
# üéØ Reglas Principales
# ==============================================================================

.PHONY: all dev build up up-d down logs ps clean fclean re pull help

# Regla por defecto: build + up en foreground
all: build up

# Modo desarrollo (frontend con watch y logs)
dev:
	@echo "üöÄ Iniciando entorno de desarrollo..."
	$(DC) $(COMPOSE_FILES) up --build -d backend
	$(DC) $(COMPOSE_FILES) run --rm --service-ports frontend npm run dev

# Construcci√≥n de im√°genes (sin cach√© si NO_CACHE=1)
build:
ifeq ($(NO_CACHE),1)
	$(DC) $(COMPOSE_FILES) build --no-cache
else
	$(DC) $(COMPOSE_FILES) build
endif

# Levantar servicios en primer plano
up:
	$(DC) $(COMPOSE_FILES) up

# Levantar servicios en segundo plano
up-d:
	$(DC) $(COMPOSE_FILES) up -d

# Apagar servicios
down:
	@echo "üõë Deteniendo y eliminando contenedores..."
	$(DC) $(COMPOSE_FILES) down --remove-orphans

# Logs en vivo
logs:
	@echo "üìú Mostrando logs en tiempo real..."
	$(DC) $(COMPOSE_FILES) logs -f --tail=200

# Estado
ps:
	$(DC) $(COMPOSE_FILES) ps

# ==============================================================================
# üßπ Limpieza
# ==============================================================================

# Limpieza ligera
clean: down
	@echo "üßπ Clean: contenedores y redes eliminados."

# Limpieza total (contenedores, redes, vol√∫menes, im√°genes locales + node_modules)
fclean:
	@echo "üí• Limpieza profunda..."
	$(DC) $(COMPOSE_FILES) down -v --remove-orphans --rmi local
	@rm -rf backend/node_modules frontend/node_modules backend/package-lock.json frontend/package-lock.json || true
	@rm -rf ./data
	@echo "‚úÖ fclean completo."

# Rebuild total
re: fclean all

# ==============================================================================
# ‚ÑπÔ∏è Ayuda
# ==============================================================================

help:
	@echo "üìñ Comandos disponibles:"
	@echo "  make              -> build + up (foreground)"
	@echo "  make dev          -> entorno de desarrollo (frontend con watchers)"
	@echo "  make build        -> construir im√°genes (NO_CACHE=1 para sin cach√©)"
	@echo "  make up           -> levantar servicios en foreground"
	@echo "  make up-d         -> levantar servicios en background"
	@echo "  make down         -> detener y eliminar contenedores"
	@echo "  make logs         -> mostrar logs en tiempo real"
	@echo "  make ps           -> estado de contenedores"
	@echo "  make clean        -> limpieza ligera"
	@echo "  make fclean       -> limpieza total (con vol√∫menes e im√°genes)"
	@echo "  make re           -> reconstrucci√≥n completa"


# END FILE CONTENTS


# File: frontend/public/dist/translate.js

var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
export let currentTranslations = {};
export function getCurrentLanguage() {
    const savedLang = localStorage.getItem('language');
    if (savedLang && ['es', 'en', 'fr'].includes(savedLang))
        return savedLang;
    const browserLang = navigator.language.split('-')[0];
    if (['es', 'en', 'fr'].includes(browserLang))
        return browserLang;
    return 'en';
}
export function loadTranslations(lang) {
    return __awaiter(this, void 0, void 0, function* () {
        try {
            const response = yield fetch(`/locales/${lang}.json`);
            if (!response.ok)
                throw new Error(`Language ${lang} not found.`);
            currentTranslations = yield response.json();
            console.log(`Translations for ${lang} loaded`);
        }
        catch (error) {
            console.error(error);
            const response = yield fetch(`/locales/en.json`);
            currentTranslations = yield response.json();
        }
    });
}
export function updateContent() {
    const lang = getCurrentLanguage();
    document.documentElement.lang = lang;
    const elements = document.querySelectorAll('[data-translate]');
    elements.forEach(el => {
        const key = el.getAttribute('data-translate');
        if (key && currentTranslations[key]) {
            el.innerHTML = currentTranslations[key];
        }
    });
}
export function changeLanguage(lang) {
    return __awaiter(this, void 0, void 0, function* () {
        localStorage.setItem('language', lang);
        yield loadTranslations(lang);
        updateContent();
    });
}
window.changeLanguage = changeLanguage;
export function initializeAnimations() {
    const gameLinks = document.querySelectorAll('.game-link');
    gameLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            link.classList.add('zoom-into-game');
            link.style.pointerEvents = 'none';
            setTimeout(() => {
                window.location.href = link.href;
            }, 500);
        });
    });
}
export function initializeLanguages() {
    return __awaiter(this, void 0, void 0, function* () {
        const initialLang = getCurrentLanguage();
        yield loadTranslations(initialLang);
        updateContent();
        window.changeLanguage = changeLanguage;
    });
}


# END FILE CONTENTS


# File: backend/package.json

{
	"name": "backend",
	"version": "1.0.0",
	"main": "index.js",
	"scripts": {
		"test": "echo \"Error: no test specified\" && exit 1",
		"dev": "node --watch src/server.js",
		"start": "node src/server.js"
	},
	"keywords": [],
	"author": "",
	"license": "ISC",
	"description": "",
	"dependencies": {
    "@fastify/cookie": "^9.3.1",
    "@fastify/cors": "^8.2.1",
    "@fastify/formbody": "^7.4.0",
    "@fastify/multipart": "^8.3.0",
    "@fastify/session": "^10.7.0",
    "@fastify/static": "^7.0.1",
    "bcrypt": "^5.1.1",
    "better-sqlite3": "^9.4.3",
    "fastify": "^4.28.1"
  	},
	"devDependencies": {
		"concurrently": "^9.2.0"
	}
}


# END FILE CONTENTS


# File: frontend/public/profile.html

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Perfil ‚Äî ft_transcendence</title>
  <link rel="stylesheet" href="/tailwind.css"/>
  <style>
    .avatar { border-radius: 50%; }
    input {
      color: #000 !important;
    }
    input:not(:placeholder-shown) {
      color: #000 !important;
    }
    input::placeholder {
      color: #6b7280 !important;
    }
  </style>
</head>
<body class="bg-black text-white flex items-center justify-center min-h-screen">
  <div class="bg-zinc-900 p-6 rounded-2xl shadow w-[520px]">
    <h1 class="text-2xl font-bold mb-4">Mi perfil</h1>
    <div id="info" class="flex items-center gap-3 mb-4"></div>

    <!-- Actualizar datos -->
    <h2 class="text-xl font-semibold mb-2">Actualizar datos</h2>
    <form id="upd" class="space-y-3 mb-4">
      <input class="w-full p-2 rounded bg-zinc-800 text-white" name="display_name" placeholder="Display name">
      <div class="flex gap-2">
        <input class="w-1/2 p-2 rounded bg-zinc-800 text-white" name="first_name" placeholder="Nombre">
        <input class="w-1/2 p-2 rounded bg-zinc-800 text-white" name="last_name" placeholder="Apellidos">
      </div>
      <input class="w-full p-2 rounded bg-zinc-800 text-white" name="birthdate" type="date">
      <button class="w-full bg-indigo-500 hover:bg-indigo-600 font-semibold py-2 rounded" type="submit">Guardar</button>
      <div id="err-upd" class="text-red-400 text-sm min-h-[1.25rem]"></div>
    </form>

    <!-- Avatar -->
    <h2 class="text-xl font-semibold mb-2">Avatar</h2>
    <form id="ava" enctype="multipart/form-data" class="space-y-3 mb-2">
      <input type="file" name="avatar" accept="image/*" class="w-full p-2 rounded bg-zinc-800 text-white">
      <button class="w-full bg-blue-500 hover:bg-blue-600 font-semibold py-2 rounded" type="submit">Subir avatar</button>
      <div id="err-ava" class="text-red-400 text-sm min-h-[1.25rem]"></div>
    </form>

    <!-- Enlaces -->
    <div class="flex justify-between mt-4">
      <a class="underline opacity-80" href="./friends.html">Amigos</a>
      <a class="underline opacity-80" href="/" onclick="logout(event)">Cerrar sesi√≥n</a>
    </div>
  </div>

  <script src="/js/api.js"></script>
  <script>
    // Sanitizar salida
    function escape(s){ 
      return (s||'').replace(/[&<>"']/g, c => (
        {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]
      )); 
    }

    // Cargar perfil
    async function me(){
      try {
        const j = await api('/api/auth/me');
        const u = j.user;
        document.getElementById('info').innerHTML = `
          <img class="avatar" src="${u.avatar_path || '/default-avatar.png'}" width="72" height="72" alt="Avatar">
          <div>
            <div class="font-bold">${escape(u.display_name)}</div>
            <div class="opacity-80 text-sm">${escape(u.email)}</div>
          </div>`;
        return u;
      } catch {
        location.href = '/login.html';
      }
    }

    // Actualizar datos
    document.getElementById('upd').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target).entries());
      const errBox = document.getElementById('err-upd');
      try {
        await api('/api/users/me', { method:'PUT', body: JSON.stringify(data) });
        await me();
        errBox.textContent = "‚úÖ Datos actualizados";
      } catch(err) {
        errBox.textContent = err?.message || "Error actualizando perfil";
      }
    });

    // Subir avatar
    document.getElementById('ava').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const errBox = document.getElementById('err-ava');
      try {
        const res = await fetch('/api/users/me/avatar', { 
          method:'POST', 
          body: fd, 
          credentials:'include' 
        });
        if(res.ok) {
          await me();
          errBox.textContent = "‚úÖ Avatar actualizado";
        } else {
          errBox.textContent = "Error subiendo avatar";
        }
      } catch {
        errBox.textContent = "Error de red subiendo avatar";
      }
    });

    // Logout
    async function logout(e){ 
      e && e.preventDefault(); 
      try { 
        await api('/api/auth/logout', { method:'POST' }); 
      } finally { 
        location.href='/'; 
      } 
    }

    // Inicializar
    me();
  </script>
</body>
</html>


# END FILE CONTENTS
